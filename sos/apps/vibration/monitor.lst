   1               		.file	"monitor.c"
   2               		.arch atmega128
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 175               	.global	monitor_init
 177               	monitor_init:
   1:/Users/Administrator/sos-2x/kernel/monitor.c **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/kernel/monitor.c **** /* ex: set ts=4 shiftwidth=4 softtabstop=4 cindent: */
   3:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <sos_inttypes.h>
   4:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <monitor.h>
   5:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <sos_info.h>
   6:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <sos_sched.h>
   7:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <hardware_types.h>
   8:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef SOS_USE_PREEMPTION
   9:/Users/Administrator/sos-2x/kernel/monitor.c **** #include <priority.h>
  10:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
  11:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  12:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  13:/Users/Administrator/sos-2x/kernel/monitor.c **** //  Typedefs
  14:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  15:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  16:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  17:/Users/Administrator/sos-2x/kernel/monitor.c **** //  Global data declarations
  18:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  19:/Users/Administrator/sos-2x/kernel/monitor.c **** static monitor_cb *cb_list;
  20:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  21:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  22:/Users/Administrator/sos-2x/kernel/monitor.c **** //  Funcation declarations
  23:/Users/Administrator/sos-2x/kernel/monitor.c **** //----------------------------------------------------------------------------
  24:/Users/Administrator/sos-2x/kernel/monitor.c **** int8_t monitor_init()
  25:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 179               	.LM1:
 180               	/* prologue: frame size=0 */
 181               	/* prologue end (size=0) */
  26:/Users/Administrator/sos-2x/kernel/monitor.c ****   cb_list = NULL;
 183               	.LM2:
 184 0000 1092 0000 		sts (cb_list)+1,__zero_reg__
 185 0004 1092 0000 		sts cb_list,__zero_reg__
  27:/Users/Administrator/sos-2x/kernel/monitor.c ****   return SOS_OK;
  28:/Users/Administrator/sos-2x/kernel/monitor.c **** }
 187               	.LM3:
 188 0008 80E0      		ldi r24,lo8(0)
 189 000a 90E0      		ldi r25,hi8(0)
 190               	/* epilogue: frame size=0 */
 191 000c 0895      		ret
 192               	/* epilogue end (size=1) */
 193               	/* function monitor_init size 7 (6) */
 195               	.Lscope0:
 201               	.global	ker_register_monitor
 203               	ker_register_monitor:
  29:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  30:/Users/Administrator/sos-2x/kernel/monitor.c **** int8_t ker_register_monitor(sos_pid_t pid, uint8_t type, monitor_cb *cb)
  31:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 205               	.LM4:
 206               	/* prologue: frame size=0 */
 207 000e 1F93      		push r17
 208 0010 CF93      		push r28
 209 0012 DF93      		push r29
 210               	/* prologue end (size=3) */
 211 0014 162F      		mov r17,r22
 212 0016 EA01      		movw r28,r20
  32:/Users/Administrator/sos-2x/kernel/monitor.c **** 	cb->mod_handle = ker_get_module(pid);
 214               	.LM5:
 215 0018 0E94 0000 		call ker_get_module
 216 001c 8983      		std Y+1,r24
 217 001e 9A83      		std Y+2,r25
  33:/Users/Administrator/sos-2x/kernel/monitor.c **** 	if(cb->mod_handle == NULL) return -ESRCH;
 219               	.LM6:
 220 0020 892B      		or r24,r25
 221 0022 19F4      		brne .L3
 223               	.LM7:
 224 0024 8DEF      		ldi r24,lo8(-3)
 225 0026 9FEF      		ldi r25,hi8(-3)
 226 0028 1BC0      		rjmp .L2
 227               	.L3:
  34:/Users/Administrator/sos-2x/kernel/monitor.c **** 	cb->type = type;
 229               	.LM8:
 230 002a 1883      		st Y,r17
  35:/Users/Administrator/sos-2x/kernel/monitor.c **** 	cb->next = NULL;
 232               	.LM9:
 233 002c 1B82      		std Y+3,__zero_reg__
 234 002e 1C82      		std Y+4,__zero_reg__
  36:/Users/Administrator/sos-2x/kernel/monitor.c **** 	if(cb_list == NULL) {
 236               	.LM10:
 237 0030 8091 0000 		lds r24,cb_list
 238 0034 9091 0000 		lds r25,(cb_list)+1
 239 0038 0097      		sbiw r24,0
 240 003a 29F4      		brne .L4
  37:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
  38:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * Current list is empty
  39:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
  40:/Users/Administrator/sos-2x/kernel/monitor.c **** 		cb_list = cb;
 242               	.LM11:
 243 003c D093 0000 		sts (cb_list)+1,r29
 244 0040 C093 0000 		sts cb_list,r28
 245 0044 0BC0      		rjmp .L5
 246               	.L4:
 247               	.LBB2:
  41:/Users/Administrator/sos-2x/kernel/monitor.c **** 	} else {
  42:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
  43:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * List is not empty, traverse the list to the end
  44:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * and add this new CB
  45:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
  46:/Users/Administrator/sos-2x/kernel/monitor.c **** 		monitor_cb *curr = cb_list;
 249               	.LM12:
 250 0046 FC01      		movw r30,r24
 251               	.L11:
  47:/Users/Administrator/sos-2x/kernel/monitor.c **** 		while(curr->next != NULL){ curr = curr->next; }
 253               	.LM13:
 254 0048 8381      		ldd r24,Z+3
 255 004a 9481      		ldd r25,Z+4
 256 004c 892B      		or r24,r25
 257 004e 21F0      		breq .L10
 258 0050 0380      		ldd __tmp_reg__,Z+3
 259 0052 F481      		ldd r31,Z+4
 260 0054 E02D      		mov r30,__tmp_reg__
 261 0056 F8CF      		rjmp .L11
 262               	.L10:
  48:/Users/Administrator/sos-2x/kernel/monitor.c **** 		curr->next = cb;
 264               	.LM14:
 265 0058 C383      		std Z+3,r28
 266 005a D483      		std Z+4,r29
 267               	.L5:
 268               	.LBE2:
  49:/Users/Administrator/sos-2x/kernel/monitor.c **** 	}
  50:/Users/Administrator/sos-2x/kernel/monitor.c **** 	return SOS_OK;
 270               	.LM15:
 271 005c 80E0      		ldi r24,lo8(0)
 272 005e 90E0      		ldi r25,hi8(0)
 273               	.L2:
 274               	/* epilogue: frame size=0 */
 275 0060 DF91      		pop r29
 276 0062 CF91      		pop r28
 277 0064 1F91      		pop r17
 278 0066 0895      		ret
 279               	/* epilogue end (size=4) */
 280               	/* function ker_register_monitor size 45 (38) */
 285               	.Lscope1:
 289               	.global	ker_deregister_monitor
 291               	ker_deregister_monitor:
  51:/Users/Administrator/sos-2x/kernel/monitor.c **** }
  52:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  53:/Users/Administrator/sos-2x/kernel/monitor.c **** int8_t ker_deregister_monitor(monitor_cb *cb)
  54:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 293               	.LM16:
 294               	/* prologue: frame size=0 */
 295               	/* prologue end (size=0) */
  55:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *curr = cb_list;
 297               	.LM17:
 298 0068 E091 0000 		lds r30,cb_list
 299 006c F091 0000 		lds r31,(cb_list)+1
  56:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *prev = cb_list;
 301               	.LM18:
 302 0070 DF01      		movw r26,r30
 303               	.L21:
  57:/Users/Administrator/sos-2x/kernel/monitor.c **** 	while(curr) {
  58:/Users/Administrator/sos-2x/kernel/monitor.c **** 		if(curr == cb) {
  59:/Users/Administrator/sos-2x/kernel/monitor.c **** 			if(curr == prev) {
  60:/Users/Administrator/sos-2x/kernel/monitor.c **** 				/**
  61:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 * Removing the head
  62:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 */
  63:/Users/Administrator/sos-2x/kernel/monitor.c **** 				cb_list = curr->next;	
  64:/Users/Administrator/sos-2x/kernel/monitor.c **** 			} else {
  65:/Users/Administrator/sos-2x/kernel/monitor.c **** 				/**
  66:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 * Removing non-head item in the list
  67:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 */
  68:/Users/Administrator/sos-2x/kernel/monitor.c **** 				prev->next = curr->next;
  69:/Users/Administrator/sos-2x/kernel/monitor.c **** 			}
  70:/Users/Administrator/sos-2x/kernel/monitor.c **** 			return SOS_OK;
  71:/Users/Administrator/sos-2x/kernel/monitor.c **** 		}
  72:/Users/Administrator/sos-2x/kernel/monitor.c **** 		prev = curr;
  73:/Users/Administrator/sos-2x/kernel/monitor.c **** 		curr = curr->next;
 305               	.LM19:
 306 0072 3097      		sbiw r30,0
 307 0074 C1F0      		breq .L20
 309               	.LM20:
 310 0076 E817      		cp r30,r24
 311 0078 F907      		cpc r31,r25
 312 007a 81F4      		brne .L15
 313 007c 8381      		ldd r24,Z+3
 314 007e 9481      		ldd r25,Z+4
 316               	.LM21:
 317 0080 EA17      		cp r30,r26
 318 0082 FB07      		cpc r31,r27
 319 0084 29F4      		brne .L16
 321               	.LM22:
 322 0086 9093 0000 		sts (cb_list)+1,r25
 323 008a 8093 0000 		sts cb_list,r24
 324 008e 03C0      		rjmp .L17
 325               	.L16:
 327               	.LM23:
 328 0090 FD01      		movw r30,r26
 329 0092 8383      		std Z+3,r24
 330 0094 9483      		std Z+4,r25
 331               	.L17:
 333               	.LM24:
 334 0096 80E0      		ldi r24,lo8(0)
 335 0098 90E0      		ldi r25,hi8(0)
 336 009a 0895      		ret
 337               	.L15:
 339               	.LM25:
 340 009c DF01      		movw r26,r30
 342               	.LM26:
 343 009e 0380      		ldd __tmp_reg__,Z+3
 344 00a0 F481      		ldd r31,Z+4
 345 00a2 E02D      		mov r30,__tmp_reg__
 346 00a4 E6CF      		rjmp .L21
 347               	.L20:
  74:/Users/Administrator/sos-2x/kernel/monitor.c **** 	}
  75:/Users/Administrator/sos-2x/kernel/monitor.c **** 	return -EINVAL;
 349               	.LM27:
 350 00a6 8AEE      		ldi r24,lo8(-22)
 351 00a8 9FEF      		ldi r25,hi8(-22)
  76:/Users/Administrator/sos-2x/kernel/monitor.c **** }
 353               	.LM28:
 354 00aa 0895      		ret
 355               	/* epilogue: frame size=0 */
 356 00ac 0895      		ret
 357               	/* epilogue end (size=1) */
 358               	/* function ker_deregister_monitor size 35 (34) */
 364               	.Lscope2:
 368               	.global	monitor_remove_all
 370               	monitor_remove_all:
  77:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  78:/Users/Administrator/sos-2x/kernel/monitor.c **** void monitor_remove_all(sos_pid_t pid )
  79:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 372               	.LM29:
 373               	/* prologue: frame size=0 */
 374 00ae CF93      		push r28
 375 00b0 DF93      		push r29
 376               	/* prologue end (size=2) */
 377 00b2 982F      		mov r25,r24
  80:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *curr = cb_list;
 379               	.LM30:
 380 00b4 A091 0000 		lds r26,cb_list
 381 00b8 B091 0000 		lds r27,(cb_list)+1
  81:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *prev = cb_list;
 383               	.LM31:
 384 00bc ED01      		movw r28,r26
  82:/Users/Administrator/sos-2x/kernel/monitor.c **** 
  83:/Users/Administrator/sos-2x/kernel/monitor.c **** 	while(curr) {
  84:/Users/Administrator/sos-2x/kernel/monitor.c **** 		if(curr->mod_handle->pid == pid) {
  85:/Users/Administrator/sos-2x/kernel/monitor.c **** 			if(curr == prev) {
  86:/Users/Administrator/sos-2x/kernel/monitor.c **** 				/**
  87:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 * Removing the head
  88:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 */
  89:/Users/Administrator/sos-2x/kernel/monitor.c **** 				cb_list = curr->next;
  90:/Users/Administrator/sos-2x/kernel/monitor.c **** 			} else {
  91:/Users/Administrator/sos-2x/kernel/monitor.c **** 				/**
  92:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 * Removing non-head item in the list
  93:/Users/Administrator/sos-2x/kernel/monitor.c **** 				 */
  94:/Users/Administrator/sos-2x/kernel/monitor.c **** 				prev->next = curr->next;
  95:/Users/Administrator/sos-2x/kernel/monitor.c **** 			}
  96:/Users/Administrator/sos-2x/kernel/monitor.c **** 			return;
  97:/Users/Administrator/sos-2x/kernel/monitor.c **** 		}
  98:/Users/Administrator/sos-2x/kernel/monitor.c **** 		prev = curr;
  99:/Users/Administrator/sos-2x/kernel/monitor.c **** 		curr = curr->next;
 386               	.LM32:
 387 00be 1097      		sbiw r26,0
 388 00c0 E1F0      		breq .L22
 389 00c2 9D01      		movw r18,r26
 390               	.L28:
 392               	.LM33:
 393 00c4 FD01      		movw r30,r26
 394 00c6 4181      		ldd r20,Z+1
 395 00c8 5281      		ldd r21,Z+2
 396 00ca FA01      		movw r30,r20
 397 00cc 8481      		ldd r24,Z+4
 398 00ce 8917      		cp r24,r25
 399 00d0 59F4      		brne .L25
 400 00d2 FD01      		movw r30,r26
 401 00d4 8381      		ldd r24,Z+3
 402 00d6 9481      		ldd r25,Z+4
 404               	.LM34:
 405 00d8 AC17      		cp r26,r28
 406 00da BD07      		cpc r27,r29
 407 00dc 11F4      		brne .L26
 409               	.LM35:
 410 00de 9C01      		movw r18,r24
 411 00e0 08C0      		rjmp .L30
 412               	.L26:
 414               	.LM36:
 415 00e2 8B83      		std Y+3,r24
 416 00e4 9C83      		std Y+4,r25
 418               	.LM37:
 419 00e6 05C0      		rjmp .L30
 420               	.L25:
 422               	.LM38:
 423 00e8 ED01      		movw r28,r26
 425               	.LM39:
 426 00ea AB81      		ldd r26,Y+3
 427 00ec BC81      		ldd r27,Y+4
 428 00ee 1097      		sbiw r26,0
 429 00f0 49F7      		brne .L28
 430               	.L30:
 431 00f2 3093 0000 		sts (cb_list)+1,r19
 432 00f6 2093 0000 		sts cb_list,r18
 433               	.L22:
 434               	/* epilogue: frame size=0 */
 435 00fa DF91      		pop r29
 436 00fc CF91      		pop r28
 437 00fe 0895      		ret
 438               	/* epilogue end (size=3) */
 439               	/* function monitor_remove_all size 41 (36) */
 445               	.Lscope3:
 449               	.global	monitor_deliver_incoming_msg_to_monitor
 451               	monitor_deliver_incoming_msg_to_monitor:
 100:/Users/Administrator/sos-2x/kernel/monitor.c **** 	}
 101:/Users/Administrator/sos-2x/kernel/monitor.c **** }
 102:/Users/Administrator/sos-2x/kernel/monitor.c **** 
 103:/Users/Administrator/sos-2x/kernel/monitor.c **** void monitor_deliver_incoming_msg_to_monitor(Message *m)
 104:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 453               	.LM40:
 454               	/* prologue: frame size=0 */
 455 0100 DF92      		push r13
 456 0102 EF92      		push r14
 457 0104 FF92      		push r15
 458 0106 0F93      		push r16
 459 0108 1F93      		push r17
 460 010a CF93      		push r28
 461 010c DF93      		push r29
 462               	/* prologue end (size=7) */
 463 010e 7C01      		movw r14,r24
 105:/Users/Administrator/sos-2x/kernel/monitor.c **** 	uint8_t type;
 106:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *curr;
 107:/Users/Administrator/sos-2x/kernel/monitor.c **** 
 108:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef MSG_TRACE
 109:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef PC_PLATFORM
 110:/Users/Administrator/sos-2x/kernel/monitor.c **** 	msg_trace(m, false);
 111:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 112:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 113:/Users/Administrator/sos-2x/kernel/monitor.c **** 	if(cb_list == NULL) return;
 465               	.LM41:
 466 0110 4091 0000 		lds r20,cb_list
 467 0114 5091 0000 		lds r21,(cb_list)+1
 468 0118 4115      		cp r20,__zero_reg__
 469 011a 5105      		cpc r21,__zero_reg__
 470 011c 09F4      		brne .+2
 471 011e 39C0      		rjmp .L31
 114:/Users/Administrator/sos-2x/kernel/monitor.c **** 	/**
 115:/Users/Administrator/sos-2x/kernel/monitor.c **** 	 * in SOS, incoming message can be both local and 
 116:/Users/Administrator/sos-2x/kernel/monitor.c **** 	 * from the network
 117:/Users/Administrator/sos-2x/kernel/monitor.c **** 	 */
 118:/Users/Administrator/sos-2x/kernel/monitor.c **** 	if(m->saddr == node_address) {
 473               	.LM42:
 474 0120 FC01      		movw r30,r24
 475 0122 2481      		ldd r18,Z+4
 476 0124 3581      		ldd r19,Z+5
 477 0126 8091 0000 		lds r24,node_address
 478 012a 9091 0000 		lds r25,(node_address)+1
 479 012e 2817      		cp r18,r24
 480 0130 3907      		cpc r19,r25
 481 0132 19F4      		brne .L33
 119:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
 120:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * local message
 121:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
 122:/Users/Administrator/sos-2x/kernel/monitor.c **** 		type = MON_LOCAL;
 483               	.LM43:
 484 0134 64E0      		ldi r22,lo8(4)
 485 0136 D62E      		mov r13,r22
 486 0138 02C0      		rjmp .L34
 487               	.L33:
 123:/Users/Administrator/sos-2x/kernel/monitor.c **** 	} else {
 124:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
 125:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * from network
 126:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
 127:/Users/Administrator/sos-2x/kernel/monitor.c **** 		type = MON_NET_INCOMING;
 489               	.LM44:
 490 013a 31E0      		ldi r19,lo8(1)
 491 013c D32E      		mov r13,r19
 492               	.L34:
 128:/Users/Administrator/sos-2x/kernel/monitor.c **** 	}
 129:/Users/Administrator/sos-2x/kernel/monitor.c **** 	curr = cb_list;
 494               	.LM45:
 495 013e 8A01      		movw r16,r20
 130:/Users/Administrator/sos-2x/kernel/monitor.c **** 	while(curr) {
 131:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
 132:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * We only deliver the message if the destination is 
 133:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * not the monitor.  It does not make sense to 
 134:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * deliver the message twice
 135:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
 136:/Users/Administrator/sos-2x/kernel/monitor.c **** 		if((curr->type & type) != 0 && 
 137:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr->mod_handle->pid != m->did) {
 138:/Users/Administrator/sos-2x/kernel/monitor.c **** 			msg_handler_t handler = 
 139:/Users/Administrator/sos-2x/kernel/monitor.c **** 				(msg_handler_t)sos_read_header_ptr(
 140:/Users/Administrator/sos-2x/kernel/monitor.c **** 							curr->mod_handle->header,
 141:/Users/Administrator/sos-2x/kernel/monitor.c **** 							offsetof(mod_header_t,module_handler));
 142:/Users/Administrator/sos-2x/kernel/monitor.c **** 			void *handler_state = curr->mod_handle->handler_state;
 143:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef SOS_USE_PREEMPTION
 144:/Users/Administrator/sos-2x/kernel/monitor.c **** 			// push the old pid and priority
 145:/Users/Administrator/sos-2x/kernel/monitor.c **** 			*pid_sp++ = curr_pid;
 146:/Users/Administrator/sos-2x/kernel/monitor.c **** 			*pri_sp++ - curr_pri;
 147:/Users/Administrator/sos-2x/kernel/monitor.c **** 			// set the new priority
 148:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pri = get_module_priority(curr->mod_handle->pid);
 149:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 150:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pid = curr->mod_handle->pid;
 151:/Users/Administrator/sos-2x/kernel/monitor.c **** 			handler(handler_state, m);
 152:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef SOS_USE_PREEMPTION
 153:/Users/Administrator/sos-2x/kernel/monitor.c **** 			// pop the old pid and priority
 154:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pid = *(--pid_sp);
 155:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pri = *(--pri_sp);
 156:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 157:/Users/Administrator/sos-2x/kernel/monitor.c **** 		}
 158:/Users/Administrator/sos-2x/kernel/monitor.c **** 		curr = curr->next;
 497               	.LM46:
 498 0140 452B      		or r20,r21
 499 0142 39F1      		breq .L31
 500               	.L38:
 502               	.LM47:
 503 0144 F801      		movw r30,r16
 504 0146 8081      		ld r24,Z
 505 0148 8D21      		and r24,r13
 506 014a E9F0      		breq .L37
 507 014c C181      		ldd r28,Z+1
 508 014e D281      		ldd r29,Z+2
 509 0150 4C81      		ldd r20,Y+4
 510 0152 F701      		movw r30,r14
 511 0154 8081      		ld r24,Z
 512 0156 4817      		cp r20,r24
 513 0158 B1F0      		breq .L37
 514               	.LBB3:
 515               	.LBB4:
 517               	.LM48:
 518 015a 8A81      		ldd r24,Y+2
 519 015c 9B81      		ldd r25,Y+3
 520 015e AA27      		clr r26
 521 0160 BB27      		clr r27
 522 0162 880F      		lsl r24
 523 0164 991F      		rol r25
 524 0166 AA1F      		rol r26
 525 0168 BB1F      		rol r27
 526 016a 0E96      		adiw r24,14
 527 016c A11D      		adc r26,__zero_reg__
 528 016e B11D      		adc r27,__zero_reg__
 529               	/* #APP */
 530 0170 ABBF      		out 59, r26
 531 0172 FC01      		movw r30, r24
 532 0174 2791      		elpm r18, Z+
 533 0176 3691      		elpm r19, Z
 534               		
 535               	/* #NOAPP */
 536               	.LBE4:
 538               	.LM49:
 539 0178 8E81      		ldd r24,Y+6
 540 017a 9F81      		ldd r25,Y+7
 542               	.LM50:
 543 017c 4093 0000 		sts curr_pid,r20
 545               	.LM51:
 546 0180 B701      		movw r22,r14
 547 0182 F901      		movw r30,r18
 548 0184 0995      		icall
 549               	.L37:
 550               	.LBE3:
 552               	.LM52:
 553 0186 F801      		movw r30,r16
 554 0188 0381      		ldd r16,Z+3
 555 018a 1481      		ldd r17,Z+4
 556 018c 0115      		cp r16,__zero_reg__
 557 018e 1105      		cpc r17,__zero_reg__
 558 0190 C9F6      		brne .L38
 559               	.L31:
 560               	/* epilogue: frame size=0 */
 561 0192 DF91      		pop r29
 562 0194 CF91      		pop r28
 563 0196 1F91      		pop r17
 564 0198 0F91      		pop r16
 565 019a FF90      		pop r15
 566 019c EF90      		pop r14
 567 019e DF90      		pop r13
 568 01a0 0895      		ret
 569               	/* epilogue end (size=8) */
 570               	/* function monitor_deliver_incoming_msg_to_monitor size 88 (73) */
 582               	.Lscope4:
 586               	.global	monitor_deliver_outgoing_msg_to_monitor
 588               	monitor_deliver_outgoing_msg_to_monitor:
 159:/Users/Administrator/sos-2x/kernel/monitor.c **** 	}
 160:/Users/Administrator/sos-2x/kernel/monitor.c **** }
 161:/Users/Administrator/sos-2x/kernel/monitor.c **** 
 162:/Users/Administrator/sos-2x/kernel/monitor.c **** void monitor_deliver_outgoing_msg_to_monitor(Message *m)
 163:/Users/Administrator/sos-2x/kernel/monitor.c **** {
 590               	.LM53:
 591               	/* prologue: frame size=0 */
 592 01a2 CF92      		push r12
 593 01a4 DF92      		push r13
 594 01a6 EF92      		push r14
 595 01a8 FF92      		push r15
 596 01aa 1F93      		push r17
 597 01ac CF93      		push r28
 598 01ae DF93      		push r29
 599               	/* prologue end (size=7) */
 600 01b0 6C01      		movw r12,r24
 164:/Users/Administrator/sos-2x/kernel/monitor.c **** 	monitor_cb *curr;
 165:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifndef SOS_USE_PREEMPTION
 166:/Users/Administrator/sos-2x/kernel/monitor.c **** 	sos_pid_t prev_pid;
 167:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 168:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef MSG_TRACE
 169:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef PC_PLATFORM
 170:/Users/Administrator/sos-2x/kernel/monitor.c **** 	msg_trace(m, true);
 171:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 172:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 173:/Users/Administrator/sos-2x/kernel/monitor.c **** 	if(cb_list == NULL) return;
 602               	.LM54:
 603 01b2 8091 0000 		lds r24,cb_list
 604 01b6 9091 0000 		lds r25,(cb_list)+1
 605 01ba 0097      		sbiw r24,0
 606 01bc 61F1      		breq .L40
 174:/Users/Administrator/sos-2x/kernel/monitor.c **** 	curr = cb_list;
 608               	.LM55:
 609 01be 7C01      		movw r14,r24
 610               	.L45:
 175:/Users/Administrator/sos-2x/kernel/monitor.c **** 	while(curr) {
 176:/Users/Administrator/sos-2x/kernel/monitor.c **** 		/**
 177:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * We only deliver the message if the source is not
 178:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * the monitor.  It does not make sense to deliver 
 179:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 * the message sent by the monitor.
 180:/Users/Administrator/sos-2x/kernel/monitor.c **** 		 */
 181:/Users/Administrator/sos-2x/kernel/monitor.c **** 		if((curr->type & MON_NET_OUTGOING) != 0 &&
 612               	.LM56:
 613 01c0 F701      		movw r30,r14
 614 01c2 8081      		ld r24,Z
 615 01c4 81FF      		sbrs r24,1
 616 01c6 21C0      		rjmp .L44
 617 01c8 C181      		ldd r28,Z+1
 618 01ca D281      		ldd r29,Z+2
 619 01cc 4C81      		ldd r20,Y+4
 620 01ce F601      		movw r30,r12
 621 01d0 8181      		ldd r24,Z+1
 622 01d2 4817      		cp r20,r24
 623 01d4 D1F0      		breq .L44
 624               	.LBB5:
 625               	.LBB6:
 182:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr->mod_handle->pid != m->sid) {
 183:/Users/Administrator/sos-2x/kernel/monitor.c **** 			msg_handler_t handler = 
 184:/Users/Administrator/sos-2x/kernel/monitor.c **** 				(msg_handler_t)sos_read_header_ptr(
 627               	.LM57:
 628 01d6 8A81      		ldd r24,Y+2
 629 01d8 9B81      		ldd r25,Y+3
 630 01da AA27      		clr r26
 631 01dc BB27      		clr r27
 632 01de 880F      		lsl r24
 633 01e0 991F      		rol r25
 634 01e2 AA1F      		rol r26
 635 01e4 BB1F      		rol r27
 636 01e6 0E96      		adiw r24,14
 637 01e8 A11D      		adc r26,__zero_reg__
 638 01ea B11D      		adc r27,__zero_reg__
 639               	/* #APP */
 640 01ec ABBF      		out 59, r26
 641 01ee FC01      		movw r30, r24
 642 01f0 2791      		elpm r18, Z+
 643 01f2 3691      		elpm r19, Z
 644               		
 645               	/* #NOAPP */
 646               	.LBE6:
 185:/Users/Administrator/sos-2x/kernel/monitor.c **** 							curr->mod_handle->header,
 186:/Users/Administrator/sos-2x/kernel/monitor.c **** 							offsetof(mod_header_t,module_handler));
 187:/Users/Administrator/sos-2x/kernel/monitor.c **** 			void *handler_state = curr->mod_handle->handler_state;
 648               	.LM58:
 649 01f4 8E81      		ldd r24,Y+6
 650 01f6 9F81      		ldd r25,Y+7
 188:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef SOS_USE_PREEMPTION
 189:/Users/Administrator/sos-2x/kernel/monitor.c **** 			// push the old pid and priority
 190:/Users/Administrator/sos-2x/kernel/monitor.c **** 			*pid_sp++ = curr_pid;
 191:/Users/Administrator/sos-2x/kernel/monitor.c **** 			*pri_sp++ = curr_pri;
 192:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pri = get_module_priority(curr->mod_handle->pid);
 193:/Users/Administrator/sos-2x/kernel/monitor.c **** #else
 194:/Users/Administrator/sos-2x/kernel/monitor.c **** 			prev_pid = curr_pid;
 652               	.LM59:
 653 01f8 1091 0000 		lds r17,curr_pid
 195:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 196:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pid = curr->mod_handle->pid;
 655               	.LM60:
 656 01fc 4093 0000 		sts curr_pid,r20
 197:/Users/Administrator/sos-2x/kernel/monitor.c **** 			handler(handler_state, m);
 658               	.LM61:
 659 0200 B601      		movw r22,r12
 660 0202 F901      		movw r30,r18
 661 0204 0995      		icall
 198:/Users/Administrator/sos-2x/kernel/monitor.c **** #ifdef SOS_USE_PREEMPTION
 199:/Users/Administrator/sos-2x/kernel/monitor.c **** 			// pop the old pid and priority
 200:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pri = *(--pri_sp);
 201:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pid = *(--pid_sp);
 202:/Users/Administrator/sos-2x/kernel/monitor.c **** #else
 203:/Users/Administrator/sos-2x/kernel/monitor.c **** 			curr_pid = prev_pid;
 663               	.LM62:
 664 0206 1093 0000 		sts curr_pid,r17
 665               	.L44:
 666               	.LBE5:
 204:/Users/Administrator/sos-2x/kernel/monitor.c **** #endif
 205:/Users/Administrator/sos-2x/kernel/monitor.c **** 		}
 206:/Users/Administrator/sos-2x/kernel/monitor.c **** 		curr = curr->next;
 668               	.LM63:
 669 020a F701      		movw r30,r14
 670 020c E380      		ldd r14,Z+3
 671 020e F480      		ldd r15,Z+4
 672 0210 E114      		cp r14,__zero_reg__
 673 0212 F104      		cpc r15,__zero_reg__
 674 0214 A9F6      		brne .L45
 675               	.L40:
 676               	/* epilogue: frame size=0 */
 677 0216 DF91      		pop r29
 678 0218 CF91      		pop r28
 679 021a 1F91      		pop r17
 680 021c FF90      		pop r15
 681 021e EF90      		pop r14
 682 0220 DF90      		pop r13
 683 0222 CF90      		pop r12
 684 0224 0895      		ret
 685               	/* epilogue end (size=8) */
 686               	/* function monitor_deliver_outgoing_msg_to_monitor size 72 (57) */
 698               	.Lscope5:
 700               		.lcomm cb_list,2
 702               		.text
 704               	Letext:
 705               	/* File "/Users/Administrator/sos-2x/kernel/monitor.c": code  288 = 0x0120 ( 244), prologues  19, e
DEFINED SYMBOLS
                            *ABS*:00000000 monitor.c
                            *ABS*:0000003f __SREG__
                            *ABS*:0000003e __SP_H__
                            *ABS*:0000003d __SP_L__
                            *ABS*:00000000 __tmp_reg__
                            *ABS*:00000001 __zero_reg__
/var/tmp//ccBrlNXR.s:177    .text:00000000 monitor_init
                             .bss:00000000 cb_list
/var/tmp//ccBrlNXR.s:203    .text:0000000e ker_register_monitor
/var/tmp//ccBrlNXR.s:291    .text:00000068 ker_deregister_monitor
/var/tmp//ccBrlNXR.s:370    .text:000000ae monitor_remove_all
/var/tmp//ccBrlNXR.s:451    .text:00000100 monitor_deliver_incoming_msg_to_monitor
/var/tmp//ccBrlNXR.s:588    .text:000001a2 monitor_deliver_outgoing_msg_to_monitor
/var/tmp//ccBrlNXR.s:704    .text:00000226 Letext

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
ker_get_module
node_address
curr_pid
