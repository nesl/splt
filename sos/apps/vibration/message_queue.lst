   1               		.file	"message_queue.c"
   2               		.arch atmega128
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 299               	.global	msg_queue_init
 301               	msg_queue_init:
   1:/Users/Administrator/sos-2x/kernel/message_queue.c **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/kernel/message_queue.c **** /* ex: set ts=4 shiftwidth=4 softtabstop=4 cindent: */
   3:/Users/Administrator/sos-2x/kernel/message_queue.c **** /*
   4:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * Copyright (c) 2003 The Regents of the University of California.
   5:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * All rights reserved.
   6:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *
   7:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * Redistribution and use in source and binary forms, with or without
   8:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * modification, are permitted provided that the following conditions
   9:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * are met:
  10:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * 1. Redistributions of source code must retain the above copyright
  11:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    notice, this list of conditions and the following disclaimer.
  12:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * 2. Redistributions in binary form must reproduce the above
  13:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    copyright notice, this list of conditions and the following
  14:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    disclaimer in the documentation and/or other materials provided
  15:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    with the distribution.
  16:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * 3. All advertising materials mentioning features or use of this
  17:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    software must display the following acknowledgement:
  18:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *       This product includes software developed by Networked &
  19:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *       Embedded Systems Lab at UCLA
  20:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * 4. Neither the name of the University nor that of the Laboratory
  21:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    may be used to endorse or promote products derived from this
  22:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *    software without specific prior written permission.
  23:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *
  24:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS''
  25:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
  26:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
  27:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS
  28:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  29:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  30:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
  31:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  32:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  33:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  34:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  35:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * SUCH DAMAGE.
  36:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *
  37:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * $Id: message_queue.c,v 1.12 2006/12/26 07:38:03 simonhan Exp $
  38:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
  39:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
  40:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief     SOS message queue implementation
  41:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @author    Simon Han (simonhan@cs.ucla.edu)
  42:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
  43:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <message_queue.h>
  44:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <message.h>
  45:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <malloc.h>
  46:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <hardware_types.h>
  47:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <monitor.h>
  48:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <string.h>
  49:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <sos_sched.h>
  50:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <slab.h>
  51:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <hardware.h>
  52:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  53:/Users/Administrator/sos-2x/kernel/message_queue.c **** #if defined (SOS_UART_CHANNEL)
  54:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <sos_uart.h>
  55:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <sos_uart_mgr.h>
  56:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
  57:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  58:/Users/Administrator/sos-2x/kernel/message_queue.c **** #if defined (SOS_I2C_CHANNEL)                                
  59:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <sos_i2c.h>                                         
  60:/Users/Administrator/sos-2x/kernel/message_queue.c **** #include <sos_i2c_mgr.h>                                     
  61:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif    
  62:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  63:/Users/Administrator/sos-2x/kernel/message_queue.c **** // Comment out the lines below to enable debug messages from this component
  64:/Users/Administrator/sos-2x/kernel/message_queue.c **** #undef DEBUG
  65:/Users/Administrator/sos-2x/kernel/message_queue.c **** #define DEBUG(...)
  66:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  67:/Users/Administrator/sos-2x/kernel/message_queue.c **** #define MSG_QUEUE_NUM_ITEMS 4
  68:/Users/Administrator/sos-2x/kernel/message_queue.c **** //----------------------------------------------------------------------------
  69:/Users/Administrator/sos-2x/kernel/message_queue.c **** //  Global data declarations
  70:/Users/Administrator/sos-2x/kernel/message_queue.c **** //----------------------------------------------------------------------------
  71:/Users/Administrator/sos-2x/kernel/message_queue.c **** static slab_t msg_slab;
  72:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  73:/Users/Administrator/sos-2x/kernel/message_queue.c **** //----------------------------------------------------------------------------
  74:/Users/Administrator/sos-2x/kernel/message_queue.c **** //  Funcation declarations
  75:/Users/Administrator/sos-2x/kernel/message_queue.c **** //----------------------------------------------------------------------------
  76:/Users/Administrator/sos-2x/kernel/message_queue.c **** int8_t msg_queue_init()
  77:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 303               	.LM1:
 304               	/* prologue: frame size=0 */
 305 0000 0F93      		push r16
 306               	/* prologue end (size=1) */
  78:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ker_slab_init( MSG_QUEUE_PID, &msg_slab, sizeof(Message), 
 308               	.LM2:
 309 0002 00E0      		ldi r16,lo8(0)
 310 0004 24E0      		ldi r18,lo8(4)
 311 0006 44E1      		ldi r20,lo8(20)
 312 0008 60E0      		ldi r22,lo8(msg_slab)
 313 000a 70E0      		ldi r23,hi8(msg_slab)
 314 000c 8BE0      		ldi r24,lo8(11)
 315 000e 0E94 0000 		call ker_slab_init
  79:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			MSG_QUEUE_NUM_ITEMS, 0 );
  80:/Users/Administrator/sos-2x/kernel/message_queue.c ****     return 0;
  81:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 317               	.LM3:
 318 0012 80E0      		ldi r24,lo8(0)
 319 0014 90E0      		ldi r25,hi8(0)
 320               	/* epilogue: frame size=0 */
 321 0016 0F91      		pop r16
 322 0018 0895      		ret
 323               	/* epilogue end (size=2) */
 324               	/* function msg_queue_init size 13 (10) */
 326               	.Lscope0:
 330               	.global	mq_init
 332               	mq_init:
  82:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
  83:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
  84:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief initialize the message queue
  85:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
  86:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_init(mq_t *q)
  87:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 334               	.LM4:
 335               	/* prologue: frame size=0 */
 336               	/* prologue end (size=0) */
 337 001a FC01      		movw r30,r24
  88:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
  89:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->head = NULL;
  90:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->msg_cnt = 0;
  91:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else 
  92:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->msg_cnt = 0;
 339               	.LM5:
 340 001c 1082      		st Z,__zero_reg__
  93:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->hm_cnt = 0;
 342               	.LM6:
 343 001e 1382      		std Z+3,__zero_reg__
  94:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->sm_cnt = 0;
 345               	.LM7:
 346 0020 1282      		std Z+2,__zero_reg__
  95:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->lm_cnt = 0;
 348               	.LM8:
 349 0022 1182      		std Z+1,__zero_reg__
  96:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->hq_head = NULL;
 351               	.LM9:
 352 0024 1482      		std Z+4,__zero_reg__
 353 0026 1582      		std Z+5,__zero_reg__
  97:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->hq_tail = NULL;
 355               	.LM10:
 356 0028 1682      		std Z+6,__zero_reg__
 357 002a 1782      		std Z+7,__zero_reg__
  98:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->sq_head = NULL;
 359               	.LM11:
 360 002c 1086      		std Z+8,__zero_reg__
 361 002e 1186      		std Z+9,__zero_reg__
  99:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->sq_tail = NULL;
 363               	.LM12:
 364 0030 1286      		std Z+10,__zero_reg__
 365 0032 1386      		std Z+11,__zero_reg__
 100:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->lq_head = NULL;
 367               	.LM13:
 368 0034 1486      		std Z+12,__zero_reg__
 369 0036 1586      		std Z+13,__zero_reg__
 101:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->lq_tail = NULL;
 371               	.LM14:
 372 0038 1686      		std Z+14,__zero_reg__
 373 003a 1786      		std Z+15,__zero_reg__
 374               	/* epilogue: frame size=0 */
 375 003c 0895      		ret
 376               	/* epilogue end (size=1) */
 377               	/* function mq_init size 18 (17) */
 379               	.Lscope1:
 384               	.global	mq_enqueue
 386               	mq_enqueue:
 102:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 103:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 104:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 105:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 106:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief enqueue message to message queue
 107:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * We enqueue the message based on the flag in the message
 108:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 109:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_enqueue(mq_t *q, Message *m)
 110:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 388               	.LM15:
 389               	/* prologue: frame size=0 */
 390 003e CF93      		push r28
 391 0040 DF93      		push r29
 392               	/* prologue end (size=2) */
 393 0042 DC01      		movw r26,r24
 394 0044 EB01      		movw r28,r22
 111:/Users/Administrator/sos-2x/kernel/message_queue.c ****   HAS_CRITICAL_SECTION;
 112:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 113:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 114:/Users/Administrator/sos-2x/kernel/message_queue.c ****   Message *cur;
 115:/Users/Administrator/sos-2x/kernel/message_queue.c ****   Message *prev;
 116:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ENTER_CRITICAL_SECTION();
 117:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 118:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // If head is empty, insert here
 119:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(q->head == NULL) {
 120:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->head = m;
 121:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	m->next = NULL;
 122:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->msg_cnt++;
 123:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 124:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return;
 125:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 126:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 127:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // Insertion at the head of the list
 128:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(q->head->priority < m->priority) {
 129:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	m->next = q->head;
 130:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->head = m;
 131:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->msg_cnt++;
 132:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 133:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return;
 134:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 135:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 136:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // Traverse through the list looking for the 
 137:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // right insertion point based on priority
 138:/Users/Administrator/sos-2x/kernel/message_queue.c ****   cur = q->head->next;
 139:/Users/Administrator/sos-2x/kernel/message_queue.c ****   prev = q->head;
 140:/Users/Administrator/sos-2x/kernel/message_queue.c ****   while(cur != NULL) {
 141:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if(cur->priority < m->priority) {
 142:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  m->next = cur;
 143:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  prev->next = m;
 144:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->msg_cnt++;
 145:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  LEAVE_CRITICAL_SECTION();
 146:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  return;
 147:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 148:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	prev = cur;
 149:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	cur = cur->next;
 150:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 151:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // End of list, insert at last point
 152:/Users/Administrator/sos-2x/kernel/message_queue.c ****   m->next = NULL;
 153:/Users/Administrator/sos-2x/kernel/message_queue.c ****   prev->next = m;
 154:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->msg_cnt++;
 155:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 156:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 157:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ENTER_CRITICAL_SECTION();
 396               	.LM16:
 397               	/* #APP */
 398 0046 2FB7      		in r18, __SREG__
 399 0048 F894      		cli
 400               		
 158:/Users/Administrator/sos-2x/kernel/message_queue.c ****   
 159:/Users/Administrator/sos-2x/kernel/message_queue.c ****   m->next = NULL;
 402               	.LM17:
 403               	/* #NOAPP */
 404 004a 1A8A      		std Y+18,__zero_reg__
 405 004c 1B8A      		std Y+19,__zero_reg__
 160:/Users/Administrator/sos-2x/kernel/message_queue.c ****   
 161:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(flag_high_priority(m->flag)){
 407               	.LM18:
 408 004e 8A85      		ldd r24,Y+10
 409 0050 9B85      		ldd r25,Y+11
 410 0052 86FF      		sbrs r24,6
 411 0054 16C0      		rjmp .L4
 162:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  //! high priority message
 163:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  if(q->hq_head == NULL) {
 413               	.LM19:
 414 0056 FD01      		movw r30,r26
 415 0058 8481      		ldd r24,Z+4
 416 005a 9581      		ldd r25,Z+5
 417 005c 892B      		or r24,r25
 418 005e 19F4      		brne .L5
 164:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! empty head
 165:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->hq_head = m;	
 420               	.LM20:
 421 0060 6483      		std Z+4,r22
 422 0062 7583      		std Z+5,r23
 423 0064 07C0      		rjmp .L14
 424               	.L5:
 166:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->hq_tail = m;
 167:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  } else {
 168:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! insert to tail
 169:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->hq_tail->next = m;
 426               	.LM21:
 427 0066 FD01      		movw r30,r26
 428 0068 8681      		ldd r24,Z+6
 429 006a 9781      		ldd r25,Z+7
 430 006c FC01      		movw r30,r24
 431 006e 628B      		std Z+18,r22
 432 0070 738B      		std Z+19,r23
 170:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->hq_tail = m;
 434               	.LM22:
 435 0072 FD01      		movw r30,r26
 436               	.L14:
 437 0074 C683      		std Z+6,r28
 438 0076 D783      		std Z+7,r29
 171:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 172:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->hm_cnt++;
 440               	.LM23:
 441 0078 FD01      		movw r30,r26
 442 007a 8381      		ldd r24,Z+3
 443 007c 8F5F      		subi r24,lo8(-(1))
 444 007e 8383      		std Z+3,r24
 445 0080 2DC0      		rjmp .L7
 446               	.L4:
 173:/Users/Administrator/sos-2x/kernel/message_queue.c ****   } else if(flag_system(m->flag)){
 448               	.LM24:
 449 0082 87FF      		sbrs r24,7
 450 0084 16C0      		rjmp .L8
 174:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  //! system msgs
 175:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  if(q->sq_head == NULL) {
 452               	.LM25:
 453 0086 FD01      		movw r30,r26
 454 0088 8085      		ldd r24,Z+8
 455 008a 9185      		ldd r25,Z+9
 456 008c 892B      		or r24,r25
 457 008e 19F4      		brne .L9
 176:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! empty head
 177:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->sq_head = m;	
 459               	.LM26:
 460 0090 6087      		std Z+8,r22
 461 0092 7187      		std Z+9,r23
 462 0094 07C0      		rjmp .L15
 463               	.L9:
 178:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->sq_tail = m;
 179:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  } else {
 180:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! insert to tail
 181:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->sq_tail->next = m;
 465               	.LM27:
 466 0096 FD01      		movw r30,r26
 467 0098 8285      		ldd r24,Z+10
 468 009a 9385      		ldd r25,Z+11
 469 009c FC01      		movw r30,r24
 470 009e 628B      		std Z+18,r22
 471 00a0 738B      		std Z+19,r23
 182:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->sq_tail = m;
 473               	.LM28:
 474 00a2 FD01      		movw r30,r26
 475               	.L15:
 476 00a4 C287      		std Z+10,r28
 477 00a6 D387      		std Z+11,r29
 183:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 184:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->sm_cnt++;
 479               	.LM29:
 480 00a8 FD01      		movw r30,r26
 481 00aa 8281      		ldd r24,Z+2
 482 00ac 8F5F      		subi r24,lo8(-(1))
 483 00ae 8283      		std Z+2,r24
 484 00b0 15C0      		rjmp .L7
 485               	.L8:
 185:/Users/Administrator/sos-2x/kernel/message_queue.c ****   } else {
 186:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  //! low priority message
 187:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  if(q->lq_head == NULL) {
 487               	.LM30:
 488 00b2 FD01      		movw r30,r26
 489 00b4 8485      		ldd r24,Z+12
 490 00b6 9585      		ldd r25,Z+13
 491 00b8 892B      		or r24,r25
 492 00ba 19F4      		brne .L12
 188:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! empty head
 189:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->lq_head = m;	
 494               	.LM31:
 495 00bc 6487      		std Z+12,r22
 496 00be 7587      		std Z+13,r23
 497 00c0 07C0      		rjmp .L16
 498               	.L12:
 190:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->lq_tail = m;
 191:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  } else {
 192:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  //! insert to tail
 193:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->lq_tail->next = m;
 500               	.LM32:
 501 00c2 FD01      		movw r30,r26
 502 00c4 8685      		ldd r24,Z+14
 503 00c6 9785      		ldd r25,Z+15
 504 00c8 FC01      		movw r30,r24
 505 00ca 628B      		std Z+18,r22
 506 00cc 738B      		std Z+19,r23
 194:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  q->lq_tail = m;
 508               	.LM33:
 509 00ce FD01      		movw r30,r26
 510               	.L16:
 511 00d0 C687      		std Z+14,r28
 512 00d2 D787      		std Z+15,r29
 195:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 196:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->lm_cnt++;
 514               	.LM34:
 515 00d4 FD01      		movw r30,r26
 516 00d6 8181      		ldd r24,Z+1
 517 00d8 8F5F      		subi r24,lo8(-(1))
 518 00da 8183      		std Z+1,r24
 519               	.L7:
 197:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 198:/Users/Administrator/sos-2x/kernel/message_queue.c ****   q->msg_cnt++;
 521               	.LM35:
 522 00dc 8C91      		ld r24,X
 523 00de 8F5F      		subi r24,lo8(-(1))
 524 00e0 8C93      		st X,r24
 199:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 200:/Users/Administrator/sos-2x/kernel/message_queue.c ****   LEAVE_CRITICAL_SECTION();
 526               	.LM36:
 527               	/* #APP */
 528 00e2 2FBF      		out __SREG__, r18
 529               		
 530               	/* #NOAPP */
 531               	/* epilogue: frame size=0 */
 532 00e4 DF91      		pop r29
 533 00e6 CF91      		pop r28
 534 00e8 0895      		ret
 535               	/* epilogue end (size=3) */
 536               	/* function mq_enqueue size 93 (88) */
 541               	.Lscope2:
 545               	.global	mq_dequeue
 547               	mq_dequeue:
 201:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 202:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 203:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 204:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief dequeue message
 205:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @return pointer to message, or NULL for empty queue
 206:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * First we check high priority queue.
 207:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * if it is empty, we check for low priority queue
 208:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 209:/Users/Administrator/sos-2x/kernel/message_queue.c **** Message *mq_dequeue(mq_t *q)
 210:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 549               	.LM37:
 550               	/* prologue: frame size=0 */
 551 00ea CF93      		push r28
 552 00ec DF93      		push r29
 553               	/* prologue end (size=2) */
 554 00ee FC01      		movw r30,r24
 211:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	HAS_CRITICAL_SECTION;
 212:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	Message *tmp = NULL;
 213:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 214:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ENTER_CRITICAL_SECTION();
 556               	.LM38:
 557               	/* #APP */
 558 00f0 2FB7      		in r18, __SREG__
 559 00f2 F894      		cli
 560               		
 215:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 216:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 217:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if((tmp = q->head) != NULL) {
 218:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->head = tmp->next;
 219:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  q->msg_cnt--;	  
 220:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 221:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 222:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 223:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if ((tmp = q->hq_head) != NULL) { 
 562               	.LM39:
 563               	/* #NOAPP */
 564 00f4 A481      		ldd r26,Z+4
 565 00f6 B581      		ldd r27,Z+5
 566 00f8 1097      		sbiw r26,0
 567 00fa 49F0      		breq .L18
 224:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	//! high priority message
 225:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->hq_head = tmp->next;
 569               	.LM40:
 570 00fc ED01      		movw r28,r26
 571 00fe 8A89      		ldd r24,Y+18
 572 0100 9B89      		ldd r25,Y+19
 573 0102 8483      		std Z+4,r24
 574 0104 9583      		std Z+5,r25
 226:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->hm_cnt--;
 576               	.LM41:
 577 0106 8381      		ldd r24,Z+3
 578 0108 8150      		subi r24,lo8(-(-1))
 579 010a 8383      		std Z+3,r24
 580 010c 1EC0      		rjmp .L19
 581               	.L18:
 227:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	//! system msgs
 228:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	} else if ((tmp = q->sq_head) != NULL) {
 583               	.LM42:
 584 010e A085      		ldd r26,Z+8
 585 0110 B185      		ldd r27,Z+9
 586 0112 1097      		sbiw r26,0
 587 0114 49F0      		breq .L20
 229:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->sq_head = tmp->next;
 589               	.LM43:
 590 0116 ED01      		movw r28,r26
 591 0118 8A89      		ldd r24,Y+18
 592 011a 9B89      		ldd r25,Y+19
 593 011c 8087      		std Z+8,r24
 594 011e 9187      		std Z+9,r25
 230:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->sm_cnt--;
 596               	.LM44:
 597 0120 8281      		ldd r24,Z+2
 598 0122 8150      		subi r24,lo8(-(-1))
 599 0124 8283      		std Z+2,r24
 600 0126 11C0      		rjmp .L19
 601               	.L20:
 231:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	} else if ((tmp = q->lq_head) != NULL) { 
 603               	.LM45:
 604 0128 A485      		ldd r26,Z+12
 605 012a B585      		ldd r27,Z+13
 606 012c 1097      		sbiw r26,0
 607 012e 49F0      		breq .L22
 232:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	//! low priority message
 233:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->lq_head = tmp->next;
 609               	.LM46:
 610 0130 ED01      		movw r28,r26
 611 0132 8A89      		ldd r24,Y+18
 612 0134 9B89      		ldd r25,Y+19
 613 0136 8487      		std Z+12,r24
 614 0138 9587      		std Z+13,r25
 234:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		q->lm_cnt--;
 616               	.LM47:
 617 013a 8181      		ldd r24,Z+1
 618 013c 8150      		subi r24,lo8(-(-1))
 619 013e 8183      		std Z+1,r24
 620 0140 04C0      		rjmp .L19
 621               	.L22:
 235:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	} else {
 236:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		LEAVE_CRITICAL_SECTION();
 623               	.LM48:
 624               	/* #APP */
 625 0142 2FBF      		out __SREG__, r18
 626               		
 237:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		return NULL;
 628               	.LM49:
 629               	/* #NOAPP */
 630 0144 80E0      		ldi r24,lo8(0)
 631 0146 90E0      		ldi r25,hi8(0)
 632 0148 05C0      		rjmp .L17
 633               	.L19:
 238:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 239:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->msg_cnt--;
 635               	.LM50:
 636 014a 8081      		ld r24,Z
 637 014c 8150      		subi r24,lo8(-(-1))
 638 014e 8083      		st Z,r24
 240:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 241:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 640               	.LM51:
 641               	/* #APP */
 642 0150 2FBF      		out __SREG__, r18
 643               		
 242:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return tmp;
 645               	.LM52:
 646               	/* #NOAPP */
 647 0152 CD01      		movw r24,r26
 648               	.L17:
 649               	/* epilogue: frame size=0 */
 650 0154 DF91      		pop r29
 651 0156 CF91      		pop r28
 652 0158 0895      		ret
 653               	/* epilogue end (size=3) */
 654               	/* function mq_dequeue size 66 (61) */
 660               	.Lscope3:
 667               	mq_real_get:
 243:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 244:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 245:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 246:/Users/Administrator/sos-2x/kernel/message_queue.c **** static Message *mq_real_get(Message **head, Message *m)
 247:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 248:/Users/Administrator/sos-2x/kernel/message_queue.c **** static Message *mq_real_get(Message **head, Message **tail, Message *m)
 249:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 250:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 669               	.LM53:
 670               	/* prologue: frame size=0 */
 671 015a AF92      		push r10
 672 015c BF92      		push r11
 673 015e CF92      		push r12
 674 0160 DF92      		push r13
 675 0162 EF92      		push r14
 676 0164 FF92      		push r15
 677 0166 0F93      		push r16
 678 0168 1F93      		push r17
 679 016a CF93      		push r28
 680 016c DF93      		push r29
 681               	/* prologue end (size=10) */
 682 016e 7C01      		movw r14,r24
 683 0170 8B01      		movw r16,r22
 684 0172 DA01      		movw r26,r20
 251:/Users/Administrator/sos-2x/kernel/message_queue.c ****   Message *prev;
 252:/Users/Administrator/sos-2x/kernel/message_queue.c ****   Message *curr;
 253:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 254:/Users/Administrator/sos-2x/kernel/message_queue.c ****   prev = *head;
 686               	.LM54:
 687 0174 EC01      		movw r28,r24
 688 0176 E881      		ld r30,Y
 689 0178 F981      		ldd r31,Y+1
 690 017a 6F01      		movw r12,r30
 255:/Users/Administrator/sos-2x/kernel/message_queue.c ****   curr = *head;
 692               	.LM55:
 693 017c BF01      		movw r22,r30
 694               	.L45:
 256:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 257:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // Traverse through the queue
 258:/Users/Administrator/sos-2x/kernel/message_queue.c ****   while(curr != NULL) {
 259:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	// Try to match the header
 260:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if(m->did == curr->did &&
 261:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	   m->sid == curr->sid &&
 262:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	   m->daddr == curr->daddr &&
 263:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	   m->saddr == curr->saddr &&
 264:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	   m->type == curr->type  &&
 265:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	   m->len == curr->len ) {
 266:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  uint8_t i = 0;
 267:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  Message *ret = curr;
 268:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  bool msg_matched = true;
 269:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  // Try to match the data
 270:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  for(i = 0; i < m->len; i++) {
 271:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		if(m->data[i] != curr->data[i]) {
 272:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  msg_matched = false;
 273:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  break;
 274:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		}	
 275:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 276:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  // A match is found
 277:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  if(msg_matched == true) {
 278:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		// The match is at the head
 279:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		if(ret == (*head)) {
 280:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  *head = curr->next;
 281:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifndef SOS_USE_PREEMPTION
 282:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  if( (*head) == NULL ) {
 283:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			*tail = NULL;
 284:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  } 
 285:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		} else if(ret == (*tail)) {
 286:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  prev->next = NULL;
 287:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  *tail = prev;
 288:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 289:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		} else {
 290:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  // The match is not at the head
 291:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		  prev->next = curr->next;
 292:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		}
 293:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		return ret;
 294:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 295:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 296:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	// increment the pointers
 297:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	prev = curr;
 298:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	curr = curr->next;
 696               	.LM56:
 697 017e 3097      		sbiw r30,0
 698 0180 09F4      		brne .+2
 699 0182 5BC0      		rjmp .L41
 701               	.LM57:
 702 0184 9C91      		ld r25,X
 703 0186 8081      		ld r24,Z
 704 0188 9817      		cp r25,r24
 705 018a 09F0      		breq .+2
 706 018c 51C0      		rjmp .L27
 707 018e ED01      		movw r28,r26
 708 0190 9981      		ldd r25,Y+1
 709 0192 8181      		ldd r24,Z+1
 710 0194 9817      		cp r25,r24
 711 0196 09F0      		breq .+2
 712 0198 4BC0      		rjmp .L27
 713 019a 2A81      		ldd r18,Y+2
 714 019c 3B81      		ldd r19,Y+3
 715 019e 8281      		ldd r24,Z+2
 716 01a0 9381      		ldd r25,Z+3
 717 01a2 2817      		cp r18,r24
 718 01a4 3907      		cpc r19,r25
 719 01a6 09F0      		breq .+2
 720 01a8 43C0      		rjmp .L27
 721 01aa 2C81      		ldd r18,Y+4
 722 01ac 3D81      		ldd r19,Y+5
 723 01ae 8481      		ldd r24,Z+4
 724 01b0 9581      		ldd r25,Z+5
 725 01b2 2817      		cp r18,r24
 726 01b4 3907      		cpc r19,r25
 727 01b6 E1F5      		brne .L27
 728 01b8 9E81      		ldd r25,Y+6
 729 01ba 8681      		ldd r24,Z+6
 730 01bc 9817      		cp r25,r24
 731 01be C1F5      		brne .L27
 732 01c0 4F81      		ldd r20,Y+7
 733 01c2 8781      		ldd r24,Z+7
 734 01c4 4817      		cp r20,r24
 735 01c6 A1F5      		brne .L27
 736               	.LBB2:
 738               	.LM58:
 739 01c8 50E0      		ldi r21,lo8(0)
 741               	.LM59:
 742 01ca 5417      		cp r21,r20
 743 01cc 78F4      		brsh .L44
 744 01ce 2085      		ldd r18,Z+8
 745 01d0 3185      		ldd r19,Z+9
 746 01d2 A884      		ldd r10,Y+8
 747 01d4 B984      		ldd r11,Y+9
 748               	.L32:
 750               	.LM60:
 751 01d6 E501      		movw r28,r10
 752 01d8 9991      		ld r25,Y+
 753 01da 5E01      		movw r10,r28
 754 01dc E901      		movw r28,r18
 755 01de 8991      		ld r24,Y+
 756 01e0 9E01      		movw r18,r28
 757 01e2 9817      		cp r25,r24
 758 01e4 29F5      		brne .L27
 760               	.LM61:
 761 01e6 5F5F      		subi r21,lo8(-(1))
 762 01e8 5417      		cp r21,r20
 763 01ea A8F3      		brlo .L32
 764               	.L44:
 766               	.LM62:
 767 01ec EC15      		cp r30,r12
 768 01ee FD05      		cpc r31,r13
 769 01f0 59F4      		brne .L34
 771               	.LM63:
 772 01f2 8289      		ldd r24,Z+18
 773 01f4 9389      		ldd r25,Z+19
 774 01f6 D701      		movw r26,r14
 775 01f8 8D93      		st X+,r24
 776 01fa 9C93      		st X,r25
 778               	.LM64:
 779 01fc 0097      		sbiw r24,0
 780 01fe B1F4      		brne .L36
 782               	.LM65:
 783 0200 E801      		movw r28,r16
 784 0202 8883      		st Y,r24
 785 0204 9983      		std Y+1,r25
 786 0206 12C0      		rjmp .L36
 787               	.L34:
 789               	.LM66:
 790 0208 D801      		movw r26,r16
 791 020a 8D91      		ld r24,X+
 792 020c 9C91      		ld r25,X
 793 020e 1197      		sbiw r26,1
 794 0210 E817      		cp r30,r24
 795 0212 F907      		cpc r31,r25
 796 0214 31F4      		brne .L37
 798               	.LM67:
 799 0216 EB01      		movw r28,r22
 800 0218 1A8A      		std Y+18,__zero_reg__
 801 021a 1B8A      		std Y+19,__zero_reg__
 803               	.LM68:
 804 021c 6D93      		st X+,r22
 805 021e 7C93      		st X,r23
 806 0220 05C0      		rjmp .L36
 807               	.L37:
 809               	.LM69:
 810 0222 8289      		ldd r24,Z+18
 811 0224 9389      		ldd r25,Z+19
 812 0226 EB01      		movw r28,r22
 813 0228 8A8B      		std Y+18,r24
 814 022a 9B8B      		std Y+19,r25
 815               	.L36:
 817               	.LM70:
 818 022c CF01      		movw r24,r30
 819 022e 07C0      		rjmp .L24
 820               	.L27:
 821               	.LBE2:
 823               	.LM71:
 824 0230 BF01      		movw r22,r30
 826               	.LM72:
 827 0232 0288      		ldd __tmp_reg__,Z+18
 828 0234 F389      		ldd r31,Z+19
 829 0236 E02D      		mov r30,__tmp_reg__
 830 0238 A2CF      		rjmp .L45
 831               	.L41:
 299:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 300:/Users/Administrator/sos-2x/kernel/message_queue.c ****   return NULL;
 833               	.LM73:
 834 023a 80E0      		ldi r24,lo8(0)
 835 023c 90E0      		ldi r25,hi8(0)
 836               	.L24:
 837               	/* epilogue: frame size=0 */
 838 023e DF91      		pop r29
 839 0240 CF91      		pop r28
 840 0242 1F91      		pop r17
 841 0244 0F91      		pop r16
 842 0246 FF90      		pop r15
 843 0248 EF90      		pop r14
 844 024a DF90      		pop r13
 845 024c CF90      		pop r12
 846 024e BF90      		pop r11
 847 0250 AF90      		pop r10
 848 0252 0895      		ret
 849               	/* epilogue end (size=11) */
 850               	/* function mq_real_get size 125 (104) */
 859               	.Lscope4:
 864               	.global	mq_get
 866               	mq_get:
 301:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 302:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 303:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 304:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief get message that matches the header in the queue
 305:/Users/Administrator/sos-2x/kernel/message_queue.c ****  *
 306:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * NOTE it matches only daddr, saddr, did, sid, type
 307:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * NOTE it only gets the first that matches the description
 308:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 309:/Users/Administrator/sos-2x/kernel/message_queue.c **** Message *mq_get(mq_t *q, Message *m)
 310:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 868               	.LM74:
 869               	/* prologue: frame size=0 */
 870 0254 FF92      		push r15
 871 0256 0F93      		push r16
 872 0258 1F93      		push r17
 873 025a CF93      		push r28
 874 025c DF93      		push r29
 875               	/* prologue end (size=5) */
 876 025e EC01      		movw r28,r24
 877 0260 8B01      		movw r16,r22
 311:/Users/Administrator/sos-2x/kernel/message_queue.c ****   HAS_CRITICAL_SECTION;
 312:/Users/Administrator/sos-2x/kernel/message_queue.c ****   Message *ret;
 313:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 314:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 315:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(q->head == NULL) return NULL;
 316:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ENTER_CRITICAL_SECTION();
 317:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 318:/Users/Administrator/sos-2x/kernel/message_queue.c ****   // Search the queue
 319:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ret = mq_real_get(&(q->head), m);
 320:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 321:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(q->msg_cnt == 0) return NULL;
 879               	.LM75:
 880 0262 8881      		ld r24,Y
 881 0264 8823      		tst r24
 882 0266 19F4      		brne .L47
 884               	.LM76:
 885 0268 80E0      		ldi r24,lo8(0)
 886 026a 90E0      		ldi r25,hi8(0)
 887 026c 22C0      		rjmp .L46
 888               	.L47:
 322:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ENTER_CRITICAL_SECTION();
 890               	.LM77:
 891               	/* #APP */
 892 026e FFB6      		in r15, __SREG__
 893 0270 F894      		cli
 894               		
 323:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 324:/Users/Administrator/sos-2x/kernel/message_queue.c ****   //! first search high priority queue
 325:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ret = mq_real_get(&(q->hq_head), &(q->hq_tail), m);
 896               	.LM78:
 897               	/* #NOAPP */
 898 0272 CE01      		movw r24,r28
 899 0274 0696      		adiw r24,6
 900 0276 AB01      		movw r20,r22
 901 0278 BC01      		movw r22,r24
 902 027a CE01      		movw r24,r28
 903 027c 0496      		adiw r24,4
 904 027e 0E94 0000 		call mq_real_get
 905 0282 9C01      		movw r18,r24
 326:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 327:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(ret) {
 907               	.LM79:
 908 0284 892B      		or r24,r25
 909 0286 29F0      		breq .L48
 328:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->msg_cnt--;
 911               	.LM80:
 912 0288 8881      		ld r24,Y
 913 028a 8150      		subi r24,lo8(-(-1))
 914 028c 8883      		st Y,r24
 329:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 916               	.LM81:
 917               	/* #APP */
 918 028e FFBE      		out __SREG__, r15
 919               		
 920               	/* #NOAPP */
 921 0290 0FC0      		rjmp .L50
 922               	.L48:
 330:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return ret;
 331:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 332:/Users/Administrator/sos-2x/kernel/message_queue.c ****   //! search low priority queue
 333:/Users/Administrator/sos-2x/kernel/message_queue.c ****   ret = mq_real_get(&(q->lq_head), &(q->lq_tail), m);
 924               	.LM82:
 925 0292 CE01      		movw r24,r28
 926 0294 0E96      		adiw r24,14
 927 0296 A801      		movw r20,r16
 928 0298 BC01      		movw r22,r24
 929 029a CE01      		movw r24,r28
 930 029c 0C96      		adiw r24,12
 931 029e 0E94 0000 		call mq_real_get
 932 02a2 9C01      		movw r18,r24
 334:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(ret) {
 934               	.LM83:
 935 02a4 892B      		or r24,r25
 936 02a6 19F0      		breq .L49
 335:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	q->msg_cnt--;
 938               	.LM84:
 939 02a8 8881      		ld r24,Y
 940 02aa 8150      		subi r24,lo8(-(-1))
 941 02ac 8883      		st Y,r24
 942               	.L49:
 336:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 337:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 338:/Users/Administrator/sos-2x/kernel/message_queue.c ****   LEAVE_CRITICAL_SECTION();
 944               	.LM85:
 945               	/* #APP */
 946 02ae FFBE      		out __SREG__, r15
 947               		
 948               	/* #NOAPP */
 949               	.L50:
 339:/Users/Administrator/sos-2x/kernel/message_queue.c ****   return ret;
 951               	.LM86:
 952 02b0 C901      		movw r24,r18
 953               	.L46:
 954               	/* epilogue: frame size=0 */
 955 02b2 DF91      		pop r29
 956 02b4 CF91      		pop r28
 957 02b6 1F91      		pop r17
 958 02b8 0F91      		pop r16
 959 02ba FF90      		pop r15
 960 02bc 0895      		ret
 961               	/* epilogue end (size=6) */
 962               	/* function mq_get size 63 (52) */
 968               	.Lscope5:
 973               	.global	mq_gc_mark_payload
 975               	mq_gc_mark_payload:
 340:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 341:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 342:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 343:/Users/Administrator/sos-2x/kernel/message_queue.c **** // mark memory in the message
 344:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 345:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_gc_mark_payload( mq_t *q, sos_pid_t pid )
 346:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 977               	.LM87:
 978               	/* prologue: frame size=0 */
 979 02be FF92      		push r15
 980 02c0 0F93      		push r16
 981 02c2 1F93      		push r17
 982 02c4 CF93      		push r28
 983 02c6 DF93      		push r29
 984               	/* prologue end (size=5) */
 985 02c8 8C01      		movw r16,r24
 986 02ca F62E      		mov r15,r22
 347:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	Message *m;
 348:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 349:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 350:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->head; m != NULL; m = m->next ) {
 351:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  if( flag_msg_release( m->flag ) ) {
 352:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		ker_gc_mark( pid, m->data );
 353:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	  }
 354:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 355:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 356:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->hq_head; m != NULL; m = m->next ) {
 988               	.LM88:
 989 02cc FC01      		movw r30,r24
 990 02ce C481      		ldd r28,Z+4
 991 02d0 D581      		ldd r29,Z+5
 992               	.L73:
 994               	.LM89:
 995 02d2 2097      		sbiw r28,0
 996 02d4 69F0      		breq .L68
 357:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		if( flag_msg_release( m->flag ) ) {
 998               	.LM90:
 999 02d6 8A85      		ldd r24,Y+10
 1000 02d8 9B85      		ldd r25,Y+11
 1001 02da 82FF      		sbrs r24,2
 1002 02dc 05C0      		rjmp .L54
 358:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			ker_gc_mark( pid, m->data );
 1004               	.LM91:
 1005 02de 6885      		ldd r22,Y+8
 1006 02e0 7985      		ldd r23,Y+9
 1007 02e2 8F2D      		mov r24,r15
 1008 02e4 0E94 0000 		call ker_gc_mark
 1009               	.L54:
 1011               	.LM92:
 1012 02e8 0A88      		ldd __tmp_reg__,Y+18
 1013 02ea DB89      		ldd r29,Y+19
 1014 02ec C02D      		mov r28,__tmp_reg__
 1015 02ee F1CF      		rjmp .L73
 1016               	.L68:
 359:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		}
 360:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 361:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 362:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->sq_head; m != NULL; m = m->next ) {
 1018               	.LM93:
 1019 02f0 F801      		movw r30,r16
 1020 02f2 C085      		ldd r28,Z+8
 1021 02f4 D185      		ldd r29,Z+9
 1022               	.L74:
 1023 02f6 2097      		sbiw r28,0
 1024 02f8 69F0      		breq .L70
 363:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		if( flag_msg_release( m->flag ) ) {
 1026               	.LM94:
 1027 02fa 8A85      		ldd r24,Y+10
 1028 02fc 9B85      		ldd r25,Y+11
 1029 02fe 82FF      		sbrs r24,2
 1030 0300 05C0      		rjmp .L59
 364:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			ker_gc_mark( pid, m->data );
 1032               	.LM95:
 1033 0302 6885      		ldd r22,Y+8
 1034 0304 7985      		ldd r23,Y+9
 1035 0306 8F2D      		mov r24,r15
 1036 0308 0E94 0000 		call ker_gc_mark
 1037               	.L59:
 1039               	.LM96:
 1040 030c 0A88      		ldd __tmp_reg__,Y+18
 1041 030e DB89      		ldd r29,Y+19
 1042 0310 C02D      		mov r28,__tmp_reg__
 1043 0312 F1CF      		rjmp .L74
 1044               	.L70:
 365:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		}
 366:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 367:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 368:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->lq_head; m != NULL; m = m->next ) {
 1046               	.LM97:
 1047 0314 F801      		movw r30,r16
 1048 0316 C485      		ldd r28,Z+12
 1049 0318 D585      		ldd r29,Z+13
 1050 031a 2097      		sbiw r28,0
 1051 031c 71F0      		breq .L72
 1052               	.L66:
 369:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		if( flag_msg_release( m->flag ) ) {
 1054               	.LM98:
 1055 031e 8A85      		ldd r24,Y+10
 1056 0320 9B85      		ldd r25,Y+11
 1057 0322 82FF      		sbrs r24,2
 1058 0324 05C0      		rjmp .L64
 370:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			ker_gc_mark( pid, m->data );
 1060               	.LM99:
 1061 0326 6885      		ldd r22,Y+8
 1062 0328 7985      		ldd r23,Y+9
 1063 032a 8F2D      		mov r24,r15
 1064 032c 0E94 0000 		call ker_gc_mark
 1065               	.L64:
 1067               	.LM100:
 1068 0330 0A88      		ldd __tmp_reg__,Y+18
 1069 0332 DB89      		ldd r29,Y+19
 1070 0334 C02D      		mov r28,__tmp_reg__
 1071 0336 2097      		sbiw r28,0
 1072 0338 91F7      		brne .L66
 1073               	.L72:
 1074               	/* epilogue: frame size=0 */
 1075 033a DF91      		pop r29
 1076 033c CF91      		pop r28
 1077 033e 1F91      		pop r17
 1078 0340 0F91      		pop r16
 1079 0342 FF90      		pop r15
 1080 0344 0895      		ret
 1081               	/* epilogue end (size=6) */
 1082               	/* function mq_gc_mark_payload size 68 (57) */
 1087               	.Lscope6:
 1092               	.global	mq_gc_mark_hdr
 1094               	mq_gc_mark_hdr:
 371:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		}
 372:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 373:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 374:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 375:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 376:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 377:/Users/Administrator/sos-2x/kernel/message_queue.c **** // mark the message header to slab
 378:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 379:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_gc_mark_hdr( mq_t *q, sos_pid_t pid )
 380:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1096               	.LM101:
 1097               	/* prologue: frame size=0 */
 1098 0346 0F93      		push r16
 1099 0348 1F93      		push r17
 1100 034a CF93      		push r28
 1101 034c DF93      		push r29
 1102               	/* prologue end (size=4) */
 1103 034e 8C01      		movw r16,r24
 381:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	Message *m;
 382:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 383:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_PREEMPTION
 384:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->head; m != NULL; m = m->next ) {
 385:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		slab_gc_mark( &msg_slab, m );
 386:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 387:/Users/Administrator/sos-2x/kernel/message_queue.c **** #else
 388:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->hq_head; m != NULL; m = m->next ) {
 1105               	.LM102:
 1106 0350 FC01      		movw r30,r24
 1107 0352 C481      		ldd r28,Z+4
 1108 0354 D581      		ldd r29,Z+5
 1109               	.L94:
 1111               	.LM103:
 1112 0356 2097      		sbiw r28,0
 1113 0358 49F0      		breq .L89
 389:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		slab_gc_mark( &msg_slab, m );
 1115               	.LM104:
 1116 035a BE01      		movw r22,r28
 1117 035c 80E0      		ldi r24,lo8(msg_slab)
 1118 035e 90E0      		ldi r25,hi8(msg_slab)
 1119 0360 0E94 0000 		call slab_gc_mark
 1121               	.LM105:
 1122 0364 0A88      		ldd __tmp_reg__,Y+18
 1123 0366 DB89      		ldd r29,Y+19
 1124 0368 C02D      		mov r28,__tmp_reg__
 1125 036a F5CF      		rjmp .L94
 1126               	.L89:
 390:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 391:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 392:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->sq_head; m != NULL; m = m->next ) {
 1128               	.LM106:
 1129 036c F801      		movw r30,r16
 1130 036e C085      		ldd r28,Z+8
 1131 0370 D185      		ldd r29,Z+9
 1132               	.L95:
 1133 0372 2097      		sbiw r28,0
 1134 0374 49F0      		breq .L91
 393:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		slab_gc_mark( &msg_slab, m );
 1136               	.LM107:
 1137 0376 BE01      		movw r22,r28
 1138 0378 80E0      		ldi r24,lo8(msg_slab)
 1139 037a 90E0      		ldi r25,hi8(msg_slab)
 1140 037c 0E94 0000 		call slab_gc_mark
 1142               	.LM108:
 1143 0380 0A88      		ldd __tmp_reg__,Y+18
 1144 0382 DB89      		ldd r29,Y+19
 1145 0384 C02D      		mov r28,__tmp_reg__
 1146 0386 F5CF      		rjmp .L95
 1147               	.L91:
 394:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 395:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 396:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	for( m = q->lq_head; m != NULL; m = m->next ) {
 1149               	.LM109:
 1150 0388 F801      		movw r30,r16
 1151 038a C485      		ldd r28,Z+12
 1152 038c D585      		ldd r29,Z+13
 1153 038e 2097      		sbiw r28,0
 1154 0390 51F0      		breq .L93
 1155               	.L87:
 397:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		slab_gc_mark( &msg_slab, m );
 1157               	.LM110:
 1158 0392 BE01      		movw r22,r28
 1159 0394 80E0      		ldi r24,lo8(msg_slab)
 1160 0396 90E0      		ldi r25,hi8(msg_slab)
 1161 0398 0E94 0000 		call slab_gc_mark
 1163               	.LM111:
 1164 039c 0A88      		ldd __tmp_reg__,Y+18
 1165 039e DB89      		ldd r29,Y+19
 1166 03a0 C02D      		mov r28,__tmp_reg__
 1167 03a2 2097      		sbiw r28,0
 1168 03a4 B1F7      		brne .L87
 1169               	.L93:
 1170               	/* epilogue: frame size=0 */
 1171 03a6 DF91      		pop r29
 1172 03a8 CF91      		pop r28
 1173 03aa 1F91      		pop r17
 1174 03ac 0F91      		pop r16
 1175 03ae 0895      		ret
 1176               	/* epilogue end (size=5) */
 1177               	/* function mq_gc_mark_hdr size 53 (44) */
 1182               	.Lscope7:
 1186               	.global	mq_gc_mark_one_hdr
 1188               	mq_gc_mark_one_hdr:
 398:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 399:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 400:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 401:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 402:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_gc_mark_one_hdr( Message *msg )
 403:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1190               	.LM112:
 1191               	/* prologue: frame size=0 */
 1192               	/* prologue end (size=0) */
 404:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	slab_gc_mark( &msg_slab, msg );
 1194               	.LM113:
 1195 03b0 BC01      		movw r22,r24
 1196 03b2 80E0      		ldi r24,lo8(msg_slab)
 1197 03b4 90E0      		ldi r25,hi8(msg_slab)
 1198 03b6 0E94 0000 		call slab_gc_mark
 1199               	/* epilogue: frame size=0 */
 1200 03ba 0895      		ret
 1201               	/* epilogue end (size=1) */
 1202               	/* function mq_gc_mark_one_hdr size 6 (5) */
 1204               	.Lscope8:
 1207               	.global	mq_gc
 1209               	mq_gc:
 405:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 406:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 407:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 408:/Users/Administrator/sos-2x/kernel/message_queue.c **** // GC on all message queues
 409:/Users/Administrator/sos-2x/kernel/message_queue.c **** //
 410:/Users/Administrator/sos-2x/kernel/message_queue.c **** void mq_gc( void )
 411:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1211               	.LM114:
 1212               	/* prologue: frame size=0 */
 1213               	/* prologue end (size=0) */
 1214               	/* epilogue: frame size=0 */
 1215 03bc 0895      		ret
 1216               	/* epilogue end (size=1) */
 1217               	/* function mq_gc size 1 (0) */
 1219               	.Lscope9:
 1222               	.global	msg_create
 1224               	msg_create:
 412:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	// TODO: call all message queues
 413:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_USE_GC
 414:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	sched_msg_gc();
 415:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_RADIO_CHANNEL
 416:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	radio_msg_gc();
 417:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 418:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 419:/Users/Administrator/sos-2x/kernel/message_queue.c **** #ifdef SOS_UART_CHANNEL
 420:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	uart_msg_gc();
 421:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 422:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	slab_gc( &msg_slab, MSG_QUEUE_PID );
 423:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	malloc_gc( MSG_QUEUE_PID );
 424:/Users/Administrator/sos-2x/kernel/message_queue.c **** #endif
 425:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 426:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 427:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 428:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief create message
 429:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @return pointer to message, or NULL for fail
 430:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * get new message header from message repositary
 431:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * msg->data is pointing to payload
 432:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 433:/Users/Administrator/sos-2x/kernel/message_queue.c **** Message *msg_create()
 434:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1226               	.LM115:
 1227               	/* prologue: frame size=0 */
 1228 03be CF93      		push r28
 1229               	/* prologue end (size=1) */
 435:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	HAS_CRITICAL_SECTION;
 436:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	Message *tmp = NULL;
 437:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	//
 438:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	// Get from msg_pool
 439:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	//
 440:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ENTER_CRITICAL_SECTION();
 1231               	.LM116:
 1232               	/* #APP */
 1233 03c0 CFB7      		in r28, __SREG__
 1234 03c2 F894      		cli
 1235               		
 441:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	tmp = ker_slab_alloc( &msg_slab, MSG_QUEUE_PID );
 1237               	.LM117:
 1238               	/* #NOAPP */
 1239 03c4 6BE0      		ldi r22,lo8(11)
 1240 03c6 80E0      		ldi r24,lo8(msg_slab)
 1241 03c8 90E0      		ldi r25,hi8(msg_slab)
 1242 03ca 0E94 0000 		call ker_slab_alloc
 1243 03ce FC01      		movw r30,r24
 442:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if( tmp == NULL ) {
 1245               	.LM118:
 1246 03d0 0097      		sbiw r24,0
 1247 03d2 21F4      		brne .L99
 443:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		LEAVE_CRITICAL_SECTION();
 1249               	.LM119:
 1250               	/* #APP */
 1251 03d4 CFBF      		out __SREG__, r28
 1252               		
 444:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		return NULL;
 1254               	.LM120:
 1255               	/* #NOAPP */
 1256 03d6 80E0      		ldi r24,lo8(0)
 1257 03d8 90E0      		ldi r25,hi8(0)
 1258 03da 07C0      		rjmp .L98
 1259               	.L99:
 445:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 446:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 447:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 1261               	.LM121:
 1262               	/* #APP */
 1263 03dc CFBF      		out __SREG__, r28
 1264               		
 448:/Users/Administrator/sos-2x/kernel/message_queue.c ****   	tmp->data = tmp->payload;
 1266               	.LM122:
 1267               	/* #NOAPP */
 1268 03de 0C96      		adiw r24,12
 1269 03e0 8087      		std Z+8,r24
 1270 03e2 9187      		std Z+9,r25
 449:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	tmp->flag = 0;
 1272               	.LM123:
 1273 03e4 1286      		std Z+10,__zero_reg__
 1274 03e6 1386      		std Z+11,__zero_reg__
 450:/Users/Administrator/sos-2x/kernel/message_queue.c ****   
 451:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return tmp;
 1276               	.LM124:
 1277 03e8 CF01      		movw r24,r30
 1278               	.L98:
 1279               	/* epilogue: frame size=0 */
 1280 03ea CF91      		pop r28
 1281 03ec 0895      		ret
 1282               	/* epilogue end (size=2) */
 1283               	/* function msg_create size 34 (31) */
 1289               	.Lscope10:
 1293               	.global	msg_dispose
 1295               	msg_dispose:
 452:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 453:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 454:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 455:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief dispose message
 456:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * return message header back to message repostitary
 457:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 458:/Users/Administrator/sos-2x/kernel/message_queue.c **** void msg_dispose(Message *m)
 459:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1297               	.LM125:
 1298               	/* prologue: frame size=0 */
 1299 03ee 1F93      		push r17
 1300 03f0 CF93      		push r28
 1301 03f2 DF93      		push r29
 1302               	/* prologue end (size=3) */
 1303 03f4 EC01      		movw r28,r24
 460:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	HAS_CRITICAL_SECTION;
 461:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 462:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	if(flag_msg_release(m->flag)) { 
 1305               	.LM126:
 1306 03f6 8A85      		ldd r24,Y+10
 1307 03f8 9B85      		ldd r25,Y+11
 1308 03fa 82FF      		sbrs r24,2
 1309 03fc 05C0      		rjmp .L101
 1310               	.LBB3:
 1311               	.LBB4:
 1313               	.Ltext1:
   1:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /* ex: set ts=4: */
   3:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /*
   4:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * Copyright (c) 2003 The Regents of the University of California.
   5:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * All rights reserved.
   6:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *
   7:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * Redistribution and use in source and binary forms, with or without
   8:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * modification, are permitted provided that the following conditions
   9:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * are met:
  10:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * 1. Redistributions of source code must retain the above copyright
  11:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    notice, this list of conditions and the following disclaimer.
  12:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * 2. Redistributions in binary form must reproduce the above
  13:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    copyright notice, this list of conditions and the following
  14:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    disclaimer in the documentation and/or other materials provided
  15:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    with the distribution.
  16:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * 3. All advertising materials mentioning features or use of this
  17:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    software must display the following acknowledgement:
  18:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *       This product includes software developed by Networked &
  19:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *       Embedded Systems Lab at UCLA
  20:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * 4. Neither the name of the University nor that of the Laboratory
  21:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    may be used to endorse or promote products derived from this
  22:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *    software without specific prior written permission.
  23:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *
  24:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS''
  25:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
  26:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
  27:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS
  28:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  29:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  30:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
  31:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  32:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  33:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  34:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  35:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * SUCH DAMAGE.
  36:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  *
  37:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief    Allocte and free dynamic memory 
  38:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @author   Roy Shea (roy@cs.ucla.edu) 
  39:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  40:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #ifndef _MALLOC_H_
  41:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #define _MALLOC_H_
  42:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  43:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #include <sos_types.h>
  44:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #include <pid.h>
  45:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #include <malloc_conf.h>
  46:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #include <sos_module_types.h>
  47:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #ifdef FAULT_TOLERANT_SOS
  48:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #include <malloc_domains.h>
  49:/Users/Administrator/sos-2x/kernel/include/malloc.h **** #endif
  50:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  51:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  52:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Init function for memory manager
  53:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  54:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void mem_init(void);
  55:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  56:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  57:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Starting memory module interface
  58:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  59:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void mem_start(void);
  60:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  61:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  62:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Allocate a chunk of blocks from the heap
  63:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  64:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void *sos_blk_mem_alloc(uint16_t size, sos_pid_t id, bool bCallFromModule);
  65:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  66:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  67:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Free a block back into the heap
  68:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  69:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void sos_blk_mem_free(void* ptr, bool bCallFromModule);
  70:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  71:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  72:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Re-allocate a block of memory from the heap
  73:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  74:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void *sos_blk_mem_realloc(void* pntr, uint16_t newSize, bool bCallFromModule);
  75:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  76:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  77:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Change memory ownership of a segment of memory
  78:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  79:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern int8_t sos_blk_mem_change_own(void* ptr, sos_pid_t id, bool bCallFromModule);
  80:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  81:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  82:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Allocate a block of memory for long term usage
  83:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  84:/Users/Administrator/sos-2x/kernel/include/malloc.h **** extern void *sos_blk_mem_longterm_alloc(uint16_t size, sos_pid_t id, bool bCallFromModule);
  85:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  86:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  87:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
  88:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Allocate dynamic memory
  89:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @param size Number of bytes to allocate
  90:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @param id Node responsible for the memory
  91:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @return Returns a pointer to the allocated memory.
  92:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * Will return a NULL pointer if the call to sys_malloc fails.
  93:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
  94:/Users/Administrator/sos-2x/kernel/include/malloc.h **** static inline void *ker_malloc(uint16_t size, sos_pid_t id)
  95:/Users/Administrator/sos-2x/kernel/include/malloc.h **** {
  96:/Users/Administrator/sos-2x/kernel/include/malloc.h ****   return sos_blk_mem_alloc(size, id, false);
  97:/Users/Administrator/sos-2x/kernel/include/malloc.h **** }
  98:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
  99:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
 100:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Reallocate dynamic memory
 101:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @param pntr Pointer to the currently held block of memory
 102:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @param newSize Number of bytes to be allocated
 103:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @return Returns the pointer to the reallocated memory.
 104:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * Returns a NULL if unable to reallocate but the original pointer is still valid.
 105:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
 106:/Users/Administrator/sos-2x/kernel/include/malloc.h **** static inline void* ker_realloc(void* pntr, uint16_t newSize)
 107:/Users/Administrator/sos-2x/kernel/include/malloc.h **** {
 108:/Users/Administrator/sos-2x/kernel/include/malloc.h ****   return sos_blk_mem_realloc(pntr, newSize, false);
 109:/Users/Administrator/sos-2x/kernel/include/malloc.h **** }
 110:/Users/Administrator/sos-2x/kernel/include/malloc.h **** 
 111:/Users/Administrator/sos-2x/kernel/include/malloc.h **** /**
 112:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @brief Free memory pointed to by ptr
 113:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @param ptr Pointer to the memory that should be released
 114:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  * @return void
 115:/Users/Administrator/sos-2x/kernel/include/malloc.h ****  */
 116:/Users/Administrator/sos-2x/kernel/include/malloc.h **** static inline void ker_free(void* ptr)
 117:/Users/Administrator/sos-2x/kernel/include/malloc.h **** {
 118:/Users/Administrator/sos-2x/kernel/include/malloc.h ****   sos_blk_mem_free(ptr, false);
 1315               	.LM127:
 1316 03fe 60E0      		ldi r22,lo8(0)
 1317 0400 8885      		ldd r24,Y+8
 1318 0402 9985      		ldd r25,Y+9
 1319 0404 0E94 0000 		call sos_blk_mem_free
 1320               	.L101:
 1321               	.LBE4:
 1322               	.LBE3:
 1324               	.Ltext2:
 463:/Users/Administrator/sos-2x/kernel/message_queue.c **** 		ker_free(m->data); 
 464:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	}
 465:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 466:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ENTER_CRITICAL_SECTION();
 1326               	.LM128:
 1327               	/* #APP */
 1328 0408 1FB7      		in r17, __SREG__
 1329 040a F894      		cli
 1330               		
 467:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ker_slab_free( &msg_slab, m );
 1332               	.LM129:
 1333               	/* #NOAPP */
 1334 040c BE01      		movw r22,r28
 1335 040e 80E0      		ldi r24,lo8(msg_slab)
 1336 0410 90E0      		ldi r25,hi8(msg_slab)
 1337 0412 0E94 0000 		call ker_slab_free
 468:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	
 469:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	LEAVE_CRITICAL_SECTION();
 1339               	.LM130:
 1340               	/* #APP */
 1341 0416 1FBF      		out __SREG__, r17
 1342               		
 1343               	/* #NOAPP */
 1344               	/* epilogue: frame size=0 */
 1345 0418 DF91      		pop r29
 1346 041a CF91      		pop r28
 1347 041c 1F91      		pop r17
 1348 041e 0895      		ret
 1349               	/* epilogue end (size=4) */
 1350               	/* function msg_dispose size 32 (25) */
 1355               	.Lscope11:
 1361               	.global	msg_send_senddone
 1363               	msg_send_senddone:
 470:/Users/Administrator/sos-2x/kernel/message_queue.c **** }
 471:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 472:/Users/Administrator/sos-2x/kernel/message_queue.c **** /**
 473:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @brief handle the process of creating senddone message
 474:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @param msg_sent  the Message just sent or delivered
 475:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @param succ      is the delivery successful?
 476:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * @param msg_owner the owner of the message 
 477:/Users/Administrator/sos-2x/kernel/message_queue.c ****  * NOTE the implementation will need to improve
 478:/Users/Administrator/sos-2x/kernel/message_queue.c ****  */
 479:/Users/Administrator/sos-2x/kernel/message_queue.c **** void msg_send_senddone(Message *msg_sent, bool succ, sos_pid_t msg_owner)
 480:/Users/Administrator/sos-2x/kernel/message_queue.c **** {
 1365               	.LM131:
 1366               	/* prologue: frame size=0 */
 1367 0420 DF92      		push r13
 1368 0422 EF92      		push r14
 1369 0424 FF92      		push r15
 1370 0426 0F93      		push r16
 1371 0428 1F93      		push r17
 1372 042a CF93      		push r28
 1373 042c DF93      		push r29
 1374               	/* prologue end (size=7) */
 1375 042e EC01      		movw r28,r24
 1376 0430 F62E      		mov r15,r22
 1377 0432 D42E      		mov r13,r20
 481:/Users/Administrator/sos-2x/kernel/message_queue.c ****   uint8_t flag;
 482:/Users/Administrator/sos-2x/kernel/message_queue.c ****   
 483:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(flag_msg_reliable(msg_sent->flag) == 0) {
 1379               	.LM132:
 1380 0434 2A85      		ldd r18,Y+10
 1381 0436 3B85      		ldd r19,Y+11
 1382 0438 C901      		movw r24,r18
 1383 043a 33E0      		ldi r19,3
 1384 043c 9695      	1:	lsr r25
 1385 043e 8795      		ror r24
 1386 0440 3A95      		dec r19
 1387 0442 E1F7      		brne 1b
 1388 0444 8095      		com r24
 1389 0446 9095      		com r25
 1390 0448 8C01      		movw r16,r24
 1391 044a 0170      		andi r16,lo8(1)
 1392 044c 1070      		andi r17,hi8(1)
 1393 044e 80FD      		sbrc r24,0
 1394 0450 1EC0      		rjmp .L110
 484:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	msg_dispose(msg_sent);
 485:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	return;
 486:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 487:/Users/Administrator/sos-2x/kernel/message_queue.c ****   
 488:/Users/Administrator/sos-2x/kernel/message_queue.c ****   /*
 489:/Users/Administrator/sos-2x/kernel/message_queue.c ****    * Release the memory 
 490:/Users/Administrator/sos-2x/kernel/message_queue.c ****    */
 491:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(flag_msg_release(msg_sent->flag)){
 1396               	.LM133:
 1397 0452 22FF      		sbrs r18,2
 1398 0454 0CC0      		rjmp .L105
 1399               	.LBB5:
 1400               	.LBB6:
 1402               	.Ltext3:
 1404               	.LM134:
 1405 0456 60E0      		ldi r22,lo8(0)
 1406 0458 8885      		ldd r24,Y+8
 1407 045a 9985      		ldd r25,Y+9
 1408 045c 0E94 0000 		call sos_blk_mem_free
 1409               	.LBE6:
 1410               	.LBE5:
 1412               	.Ltext4:
 492:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	ker_free(msg_sent->data);
 493:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	msg_sent->flag &= ~(SOS_MSG_RELEASE);
 1414               	.LM135:
 1415 0460 8A85      		ldd r24,Y+10
 1416 0462 9B85      		ldd r25,Y+11
 1417 0464 8B7F      		andi r24,lo8(-5)
 1418 0466 8A87      		std Y+10,r24
 1419 0468 9B87      		std Y+11,r25
 494:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	msg_sent->data = NULL;
 1421               	.LM136:
 1422 046a 0887      		std Y+8,r16
 1423 046c 1987      		std Y+9,r17
 1424               	.L105:
 495:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 496:/Users/Administrator/sos-2x/kernel/message_queue.c **** 
 497:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(succ == false) {
 1426               	.LM137:
 1427 046e FF20      		tst r15
 1428 0470 11F4      		brne .L107
 498:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	flag = SOS_MSG_SEND_FAIL; 
 1430               	.LM138:
 1431 0472 82E0      		ldi r24,lo8(2)
 1432 0474 01C0      		rjmp .L108
 1433               	.L107:
 499:/Users/Administrator/sos-2x/kernel/message_queue.c ****   } else {
 500:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	flag = 0;
 1435               	.LM139:
 1436 0476 80E0      		ldi r24,lo8(0)
 1437               	.L108:
 501:/Users/Administrator/sos-2x/kernel/message_queue.c ****   }
 502:/Users/Administrator/sos-2x/kernel/message_queue.c ****   if(post_long(msg_sent->sid, msg_owner, MSG_PKT_SENDDONE, 
 1439               	.LM140:
 1440 0478 9927      		clr r25
 1441 047a 7C01      		movw r14,r24
 1442 047c 8E01      		movw r16,r28
 1443 047e 24E1      		ldi r18,lo8(20)
 1444 0480 43E0      		ldi r20,lo8(3)
 1445 0482 6D2D      		mov r22,r13
 1446 0484 8981      		ldd r24,Y+1
 1447 0486 0E94 0000 		call post_long
 1448 048a 87FF      		sbrs r24,7
 1449 048c 03C0      		rjmp .L103
 1450               	.L110:
 503:/Users/Administrator/sos-2x/kernel/message_queue.c **** 			   sizeof(Message), msg_sent, flag) < 0) {
 504:/Users/Administrator/sos-2x/kernel/message_queue.c **** 	msg_dispose(msg_sent);
 1452               	.LM141:
 1453 048e CE01      		movw r24,r28
 1454 0490 0E94 0000 		call msg_dispose
 1455               	.L103:
 1456               	/* epilogue: frame size=0 */
 1457 0494 DF91      		pop r29
 1458 0496 CF91      		pop r28
 1459 0498 1F91      		pop r17
 1460 049a 0F91      		pop r16
 1461 049c FF90      		pop r15
 1462 049e EF90      		pop r14
 1463 04a0 DF90      		pop r13
 1464 04a2 0895      		ret
 1465               	/* epilogue end (size=8) */
 1466               	/* function msg_send_senddone size 67 (52) */
 1471               	.Lscope12:
 1473               		.lcomm msg_slab,6
 1475               		.text
 1477               	Letext:
 1478               	/* File "/Users/Administrator/sos-2x/kernel/message_queue.c": code  639 = 0x027f ( 546), prologues 
DEFINED SYMBOLS
                            *ABS*:00000000 message_queue.c
                            *ABS*:0000003f __SREG__
                            *ABS*:0000003e __SP_H__
                            *ABS*:0000003d __SP_L__
                            *ABS*:00000000 __tmp_reg__
                            *ABS*:00000001 __zero_reg__
/var/tmp//ccqlstLl.s:301    .text:00000000 msg_queue_init
                             .bss:00000000 msg_slab
/var/tmp//ccqlstLl.s:332    .text:0000001a mq_init
/var/tmp//ccqlstLl.s:386    .text:0000003e mq_enqueue
/var/tmp//ccqlstLl.s:547    .text:000000ea mq_dequeue
/var/tmp//ccqlstLl.s:667    .text:0000015a mq_real_get
/var/tmp//ccqlstLl.s:866    .text:00000254 mq_get
/var/tmp//ccqlstLl.s:975    .text:000002be mq_gc_mark_payload
/var/tmp//ccqlstLl.s:1094   .text:00000346 mq_gc_mark_hdr
/var/tmp//ccqlstLl.s:1188   .text:000003b0 mq_gc_mark_one_hdr
/var/tmp//ccqlstLl.s:1209   .text:000003bc mq_gc
/var/tmp//ccqlstLl.s:1224   .text:000003be msg_create
/var/tmp//ccqlstLl.s:1295   .text:000003ee msg_dispose
/var/tmp//ccqlstLl.s:1363   .text:00000420 msg_send_senddone
/var/tmp//ccqlstLl.s:1477   .text:000004a4 Letext

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
ker_slab_init
ker_gc_mark
slab_gc_mark
ker_slab_alloc
sos_blk_mem_free
ker_slab_free
post_long
