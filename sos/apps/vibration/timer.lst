   1               		.file	"timer.c"
   2               		.arch atmega128
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 226               	.global	timer_hardware_init
 228               	timer_hardware_init:
   1:/Users/Administrator/sos-2x/processor/avr/timer.c **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/processor/avr/timer.c **** /* ex: set ts=4 shiftwidth=4 softtabstop=4 cindent: */
   3:/Users/Administrator/sos-2x/processor/avr/timer.c **** /*                                  tab:4
   4:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * "Copyright (c) 2000-2003 The Regents of the University  of California.  
   5:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * All rights reserved.
   6:/Users/Administrator/sos-2x/processor/avr/timer.c ****  *
   7:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * Permission to use, copy, modify, and distribute this software and its
   8:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * documentation for any purpose, without fee, and without written agreement is
   9:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * hereby granted, provided that the above copyright notice, the following
  10:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * two paragraphs and the author appear in all copies of this software.
  11:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * 
  12:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * IN NO EVENT SHALL THE UNIVERSITY OF CALIFORNIA BE LIABLE TO ANY PARTY FOR
  13:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * DIRECT, INDIRECT, SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING OUT
  14:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * OF THE USE OF THIS SOFTWARE AND ITS DOCUMENTATION, EVEN IF THE UNIVERSITY OF
  15:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * CALIFORNIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  16:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * 
  17:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * THE UNIVERSITY OF CALIFORNIA SPECIFICALLY DISCLAIMS ANY WARRANTIES,
  18:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY
  19:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * AND FITNESS FOR A PARTICULAR PURPOSE.  THE SOFTWARE PROVIDED HEREUNDER IS
  20:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * ON AN "AS IS" BASIS, AND THE UNIVERSITY OF CALIFORNIA HAS NO OBLIGATION TO
  21:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * PROVIDE MAINTENANCE, SUPPORT, UPDATES, ENHANCEMENTS, OR MODIFICATIONS."
  22:/Users/Administrator/sos-2x/processor/avr/timer.c ****  *
  23:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * Copyright (c) 2002-2003 Intel Corporation
  24:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * All rights reserved.
  25:/Users/Administrator/sos-2x/processor/avr/timer.c ****  *
  26:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * This file is distributed under the terms in the attached INTEL-LICENSE     
  27:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * file. If you do not find these files, copies can be found by writing to
  28:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * Intel Research Berkeley, 2150 Shattuck Avenue, Suite 1300, Berkeley, CA, 
  29:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * 94704.  Attention:  Intel License Inquiry.
  30:/Users/Administrator/sos-2x/processor/avr/timer.c ****  *
  31:/Users/Administrator/sos-2x/processor/avr/timer.c ****  */
  32:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  33:/Users/Administrator/sos-2x/processor/avr/timer.c **** #include <sos_timer.h>
  34:/Users/Administrator/sos-2x/processor/avr/timer.c **** #include <sos.h>
  35:/Users/Administrator/sos-2x/processor/avr/timer.c **** #include "timer.h"
  36:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  37:/Users/Administrator/sos-2x/processor/avr/timer.c **** /** 
  38:/Users/Administrator/sos-2x/processor/avr/timer.c ****  * @brief timer hardware routine
  39:/Users/Administrator/sos-2x/processor/avr/timer.c ****  */
  40:/Users/Administrator/sos-2x/processor/avr/timer.c **** void timer_hardware_init(uint8_t interval, uint8_t scale){
 230               	.LM1:
 231               	/* prologue: frame size=0 */
 232               	/* prologue end (size=0) */
 233 0000 382F      		mov r19,r24
 234 0002 962F      		mov r25,r22
  41:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	HAS_CRITICAL_SECTION;
  42:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	ENTER_CRITICAL_SECTION();
 236               	.LM2:
 237               	/* #APP */
 238 0004 2FB7      		in r18, __SREG__
 239 0006 F894      		cli
 240               		
  43:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  44:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	scale &= 0x7;
 242               	.LM3:
 243               	/* #NOAPP */
 244 0008 9770      		andi r25,lo8(7)
  45:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	scale |= (1<<WGM1); // reset on match
 246               	.LM4:
 247 000a 9860      		ori r25,lo8(8)
  46:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	
  47:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  48:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	TIMSK &= ((unsigned char)~(1 << (TOIE0)));
 249               	.LM5:
 250 000c 87B7      		in r24,87-0x20
 251 000e 8E7F      		andi r24,lo8(-2)
 252 0010 87BF      		out 87-0x20,r24
  49:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	TIMSK &= ((unsigned char)~(1 << (OCIE0)));
 254               	.LM6:
 255 0012 87B7      		in r24,87-0x20
 256 0014 8D7F      		andi r24,lo8(-3)
 257 0016 87BF      		out 87-0x20,r24
  50:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	//!< Disable TC0 interrupt
  51:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  52:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	/** 
  53:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	 *  set Timer/Counter0 to be asynchronous 
  54:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	 *  from the CPU clock with a second external 
  55:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	 *  clock(32,768kHz)driving it
  56:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	 */
  57:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	ASSR |= (1 << (AS0)); //!< us external oscillator
 259               	.LM7:
 260 0018 80B7      		in r24,80-0x20
 261 001a 8860      		ori r24,lo8(8)
 262 001c 80BF      		out 80-0x20,r24
  58:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	TCCR0 = scale;
 264               	.LM8:
 265 001e 93BF      		out 83-0x20,r25
  59:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	TCNT0 = 0;
 267               	.LM9:
 268 0020 12BE      		out 82-0x20,__zero_reg__
  60:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	OCR0 = interval;
 270               	.LM10:
 271 0022 31BF      		out 81-0x20,r19
 272               	.LBB2:
 273               	.LBB3:
 275               	.Ltext1:
   1:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /* ex: set ts=4 shiftwidth=4 softtabstop=4 cindent: */
   3:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /*
   4:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * Copyright (c) 2003 The Regents of the University of California.
   5:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * All rights reserved.
   6:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *
   7:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * Redistribution and use in source and binary forms, with or without
   8:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * modification, are permitted provided that the following conditions
   9:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * are met:
  10:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * 1. Redistributions of source code must retain the above copyright
  11:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    notice, this list of conditions and the following disclaimer.
  12:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * 2. Redistributions in binary form must reproduce the above
  13:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    copyright notice, this list of conditions and the following
  14:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    disclaimer in the documentation and/or other materials provided
  15:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    with the distribution.
  16:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * 3. All advertising materials mentioning features or use of this
  17:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    software must display the following acknowledgement:
  18:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *       This product includes software developed by Networked &
  19:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *       Embedded Systems Lab at UCLA
  20:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * 4. Neither the name of the University nor that of the Laboratory
  21:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    may be used to endorse or promote products derived from this
  22:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *    software without specific prior written permission.
  23:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *
  24:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * THIS SOFTWARE IS PROVIDED BY THE REGENTS AND CONTRIBUTORS ``AS IS''
  25:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED
  26:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
  27:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE REGENTS
  28:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  29:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  30:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF
  31:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  32:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
  33:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
  34:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
  35:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * SUCH DAMAGE.
  36:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  *
  37:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  */
  38:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 
  39:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** #ifndef _TIMER_H
  40:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** #define _TIMER_H
  41:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** #include <avr/interrupt.h>
  42:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 
  43:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** #define PROCESSOR_TICKS(x) x
  44:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 
  45:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /**
  46:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @brief Initialize the timer hardware
  47:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @param interval Hardware timer interval
  48:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @param scale The hardware pre-scalar setting
  49:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  */
  50:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** extern void timer_hardware_init(uint8_t interval, uint8_t scale);
  51:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /**
  52:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @brief Set a new value for the timer interval
  53:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @param val The value of the new interval
  54:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  */
  55:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** extern void timer_setInterval(int32_t val);
  56:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** // Timer Interrupt from hardware
  57:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** #define timer_interrupt()    SIGNAL(SIG_OUTPUT_COMPARE0)
  58:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /**
  59:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @brief Get the current interval setting
  60:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  */ 
  61:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** static inline uint8_t timer_getInterval()   {return OCR0 + 1;}
  62:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** /**
  63:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  * @brief Get the current value stored in the hardware register
  64:/Users/Administrator/sos-2x/processor/avr/include/timer.h ****  */
  65:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** static inline uint8_t timer_hardware_get_counter()
  66:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** {
  67:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 	return TCNT0;
  68:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** }
  69:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 
  70:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** static inline void timer_disable_interrupt()
  71:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** {
  72:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 	TIMSK &= ~(1 << (OCIE0));
  73:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** }
  74:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 
  75:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** static inline void timer_enable_interrupt()
  76:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** {
  77:/Users/Administrator/sos-2x/processor/avr/include/timer.h **** 	TIMSK |= (1 << (OCIE0));
 277               	.LM11:
 278 0024 87B7      		in r24,87-0x20
 279 0026 8260      		ori r24,lo8(2)
 280 0028 87BF      		out 87-0x20,r24
 281               	.LBE3:
 282               	.LBE2:
 284               	.Ltext2:
  61:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	//TIMSK |= (1 << (OCIE0)); replaced by the line below
  62:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	timer_enable_interrupt();
  63:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	LEAVE_CRITICAL_SECTION();
 286               	.LM12:
 287               	/* #APP */
 288 002a 2FBF      		out __SREG__, r18
 289               		
  64:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  65:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	timer_init();
 291               	.LM13:
 292               	/* #NOAPP */
 293 002c 0E94 0000 		call timer_init
 294               	/* epilogue: frame size=0 */
 295 0030 0895      		ret
 296               	/* epilogue end (size=1) */
 297               	/* function timer_hardware_init size 32 (31) */
 302               	.Lscope0:
 306               	.global	timer_setInterval
 308               	timer_setInterval:
  66:/Users/Administrator/sos-2x/processor/avr/timer.c **** }   
  67:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  68:/Users/Administrator/sos-2x/processor/avr/timer.c **** void timer_setInterval(int32_t val)
  69:/Users/Administrator/sos-2x/processor/avr/timer.c **** {
 310               	.LM14:
 311               	/* prologue: frame size=0 */
 312               	/* prologue end (size=0) */
 313 0032 9B01      		movw r18,r22
 314 0034 AC01      		movw r20,r24
 315               	.L4:
  70:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	uint8_t interval;
  71:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	while ((ASSR & (_BV(OCR0UB) | _BV(TCN0UB))) != 0);
 317               	.LM15:
 318 0036 80B7      		in r24,80-0x20
 319 0038 9927      		clr r25
 320 003a 8670      		andi r24,lo8(6)
 321 003c 9070      		andi r25,hi8(6)
 322 003e 892B      		or r24,r25
 323 0040 D1F7      		brne .L4
  72:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  73:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	if(val > 250) {interval = 250;}
 325               	.LM16:
 326 0042 2B3F      		cpi r18,lo8(251)
 327 0044 3105      		cpc r19,__zero_reg__
 328 0046 4105      		cpc r20,__zero_reg__
 329 0048 5105      		cpc r21,__zero_reg__
 330 004a 14F0      		brlt .L6
 331 004c 6AEF      		ldi r22,lo8(-6)
 332 004e 09C0      		rjmp .L7
 333               	.L6:
  74:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	else if(val <= 2) {interval = 2;}
 335               	.LM17:
 336 0050 2330      		cpi r18,lo8(3)
 337 0052 3105      		cpc r19,__zero_reg__
 338 0054 4105      		cpc r20,__zero_reg__
 339 0056 5105      		cpc r21,__zero_reg__
 340 0058 14F4      		brge .L8
 341 005a 62E0      		ldi r22,lo8(2)
 342 005c 02C0      		rjmp .L7
 343               	.L8:
  75:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	else {interval = (uint8_t)val - 1;}
 345               	.LM18:
 346 005e 622F      		mov r22,r18
 347 0060 6150      		subi r22,lo8(-(-1))
 348               	.L7:
  76:/Users/Administrator/sos-2x/processor/avr/timer.c **** 
  77:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	//! reset hardware counter
  78:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	TCNT0 = 0;
 350               	.LM19:
 351 0062 12BE      		out 82-0x20,__zero_reg__
  79:/Users/Administrator/sos-2x/processor/avr/timer.c **** 	OCR0 = interval;
 353               	.LM20:
 354 0064 61BF      		out 81-0x20,r22
 355               	/* epilogue: frame size=0 */
 356 0066 0895      		ret
 357               	/* epilogue end (size=1) */
 358               	/* function timer_setInterval size 27 (26) */
 363               	.Lscope1:
 365               		.text
 367               	Letext:
 368               	/* File "/Users/Administrator/sos-2x/processor/avr/timer.c": code   59 = 0x003b (  57), prologues  
DEFINED SYMBOLS
                            *ABS*:00000000 timer.c
                            *ABS*:0000003f __SREG__
                            *ABS*:0000003e __SP_H__
                            *ABS*:0000003d __SP_L__
                            *ABS*:00000000 __tmp_reg__
                            *ABS*:00000001 __zero_reg__
/var/tmp//ccFCFudx.s:228    .text:00000000 timer_hardware_init
/var/tmp//ccFCFudx.s:308    .text:00000032 timer_setInterval
/var/tmp//ccFCFudx.s:367    .text:00000068 Letext

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
timer_init
