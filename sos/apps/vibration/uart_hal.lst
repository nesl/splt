   1               		.file	"uart_hal.c"
   2               		.arch atmega128
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 292               		.lcomm uart_initialized,1
 294               	.global	uart_hardware_init
 296               	uart_hardware_init:
   1:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** /* -*- Mode: C; tab-width:4 -*- */
   2:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** /* ex: set ts=4 shiftwidth=4 softtabstop=4 cindent: */
   3:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** /**
   4:/Users/Administrator/sos-2x/processor/avr/uart_hal.c ****  * @brief    uart hdlc driver
   5:/Users/Administrator/sos-2x/processor/avr/uart_hal.c ****  * @author	 Naim Busek <ndbusek@gmail.com>
   6:/Users/Administrator/sos-2x/processor/avr/uart_hal.c ****  *
   7:/Users/Administrator/sos-2x/processor/avr/uart_hal.c ****  */
   8:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
   9:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <hardware.h>
  10:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <net_stack.h>
  11:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <sos_info.h>
  12:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <crc.h>
  13:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <measurement.h>
  14:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <malloc.h>
  15:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  16:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #include <uart_hal.h>
  17:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  18:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** static bool uart_initialized = false;
  19:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  20:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** int8_t uart_hardware_init(void){
 298               	.LM1:
 299               	/* prologue: frame size=0 */
 300               	/* prologue end (size=0) */
  21:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 	HAS_CRITICAL_SECTION;
  22:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  23:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 	if(uart_initialized == false) {
 302               	.LM2:
 303 0000 8091 0000 		lds r24,uart_initialized
 304 0004 8823      		tst r24
 305 0006 89F4      		brne .L2
  24:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		ENTER_CRITICAL_SECTION();
 307               	.LM3:
 308               	/* #APP */
 309 0008 9FB7      		in r25, __SREG__
 310 000a F894      		cli
 311               		
  25:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #ifndef DISABLE_UART
  26:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #ifndef USE_UART1
  27:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//! UART will run at: 115kbps, N-8-1
  28:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//! Set 115.2 KBps
  29:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		// Warning: 115.2 may cause problems with MIB510 type files
  30:/Users/Administrator/sos-2x/processor/avr/uart_hal.c ****         //UBRR0H = (uint8_t) (BAUD_115_2k_U2X>>8);
  31:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//UBRR0L = (uint8_t) (BAUD_115_2k_U2X);
  32:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//! Set 57.6 KBps
  33:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UBRR0H = (uint8_t) (BAUD_57_6k_U2X>>8);
 313               	.LM4:
 314               	/* #NOAPP */
 315 000c 8093 9000 		sts 144,r24
  34:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UBRR0L = (uint8_t) (BAUD_57_6k_U2X);
 317               	.LM5:
 318 0010 8FE0      		ldi r24,lo8(15)
 319 0012 89B9      		out 41-0x20,r24
  35:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  36:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//! Set UART double speed
  37:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR0A = (1 << U2X);
 321               	.LM6:
 322 0014 82E0      		ldi r24,lo8(2)
 323 0016 8BB9      		out 43-0x20,r24
  38:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		//! Set frame format: 8 data-bits, 1 stop-bit
  39:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR0C = ((1 << UCSZ1) | (1 << UCSZ0));
 325               	.LM7:
 326 0018 86E0      		ldi r24,lo8(6)
 327 001a 8093 9500 		sts 149,r24
  40:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		/**
  41:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		 * Enable reciever and transmitter and their interrupts
  42:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		 * transmit interrupt will be disabled until there is 
  43:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		 * packet to send.
  44:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		 */
  45:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  46:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR0B = ((1 << RXCIE) | (1 << RXEN) | (1 << TXEN));
 329               	.LM8:
 330 001e 88E9      		ldi r24,lo8(-104)
 331 0020 8AB9      		out 42-0x20,r24
  47:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #else
  48:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  49:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UBRR1H = (uint8_t) (BAUD_57_6k_U2X>>8);
  50:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UBRR1L = (uint8_t) (BAUD_57_6k_U2X);
  51:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR1A = (1 << U2X);
  52:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR1C = ((1 << UCSZ1) | (1 << UCSZ0));
  53:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		UCSR1B = ((1 << RXCIE) | (1 << RXEN) | (1 << TXEN));
  54:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #endif
  55:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  56:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #ifdef SOS_USE_PRINTF
  57:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		fdevopen(uart_putchar, NULL, 0);
  58:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #endif
  59:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #else
  60:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		uart_disable();
  61:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** #endif
  62:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 
  63:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		LEAVE_CRITICAL_SECTION();
 333               	.LM9:
 334               	/* #APP */
 335 0022 9FBF      		out __SREG__, r25
 336               		
  64:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 		uart_initialized = true;
 338               	.LM10:
 339               	/* #NOAPP */
 340 0024 81E0      		ldi r24,lo8(1)
 341 0026 8093 0000 		sts uart_initialized,r24
 342               	.L2:
  65:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 	}
  66:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** 	return SOS_OK;
  67:/Users/Administrator/sos-2x/processor/avr/uart_hal.c **** }
 344               	.LM11:
 345 002a 80E0      		ldi r24,lo8(0)
 346 002c 90E0      		ldi r25,hi8(0)
 347               	/* epilogue: frame size=0 */
 348 002e 0895      		ret
 349               	/* epilogue end (size=1) */
 350               	/* function uart_hardware_init size 31 (30) */
 355               	.Lscope0:
 358               		.text
 360               	Letext:
 361               	/* File "/Users/Administrator/sos-2x/processor/avr/uart_hal.c": code   31 = 0x001f (  30), prologue
DEFINED SYMBOLS
                            *ABS*:00000000 uart_hal.c
                            *ABS*:0000003f __SREG__
                            *ABS*:0000003e __SP_H__
                            *ABS*:0000003d __SP_L__
                            *ABS*:00000000 __tmp_reg__
                            *ABS*:00000001 __zero_reg__
                             .bss:00000000 uart_initialized
/var/tmp//ccH9o9T1.s:296    .text:00000000 uart_hardware_init
/var/tmp//ccH9o9T1.s:360    .text:00000030 Letext

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
