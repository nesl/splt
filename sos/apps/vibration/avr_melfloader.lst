   1               		.file	"avr_melfloader.c"
   2               		.arch atmega128
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  12               		.text
  13               	.Ltext0:
 211               	.global	melf_arch_relocate
 213               	melf_arch_relocate:
   1:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** /**
   2:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****  * \file avr_melfloader.c
   3:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****  * \brief Mini-ELF loader specific to AVR architecture
   4:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****  * \author Ram Kumar {ram@ee.ucla.edu}
   5:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****  */
   6:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** #define STT_FILE 4
   7:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** #include <avr_minielf.h>
   8:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** #include <melfloader.h>
   9:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** #include <codemem.h>
  10:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** #include <fntable.h>
  11:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  12:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** static inline void WRITE_LDI(uint8_t* instr, uint8_t byte);
  13:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  14:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** //----------------------------------------------------------
  15:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** int8_t melf_arch_relocate(melf_desc_t* mdesc, Melf_Rela* rela, Melf_Sym* sym, Melf_Shdr* progshdr)
  16:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** {
 215               	.LM1:
 216               	/* prologue: frame size=4 */
 217 0000 4F92      		push r4
 218 0002 5F92      		push r5
 219 0004 6F92      		push r6
 220 0006 7F92      		push r7
 221 0008 8F92      		push r8
 222 000a 9F92      		push r9
 223 000c AF92      		push r10
 224 000e BF92      		push r11
 225 0010 CF92      		push r12
 226 0012 DF92      		push r13
 227 0014 EF92      		push r14
 228 0016 FF92      		push r15
 229 0018 0F93      		push r16
 230 001a 1F93      		push r17
 231 001c CF93      		push r28
 232 001e DF93      		push r29
 233 0020 CDB7      		in r28,__SP_L__
 234 0022 DEB7      		in r29,__SP_H__
 235 0024 2497      		sbiw r28,4
 236 0026 0FB6      		in __tmp_reg__,__SREG__
 237 0028 F894      		cli
 238 002a DEBF      		out __SP_H__,r29
 239 002c 0FBE      		out __SREG__,__tmp_reg__
 240 002e CDBF      		out __SP_L__,r28
 241               	/* prologue end (size=24) */
 242 0030 2C01      		movw r4,r24
 243 0032 5B01      		movw r10,r22
 244 0034 3A01      		movw r6,r20
 245 0036 F901      		movw r30,r18
  17:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   uint8_t instr[4];
  18:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   uint32_t reloc_addr;
  19:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   Melf_Addr reloc_offset;
  20:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   
  21:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   reloc_offset = (Melf_Addr)(progshdr->sh_offset) + rela->r_offset;
 247               	.LM2:
 248 0038 4281      		ldd r20,Z+2
 249 003a 5381      		ldd r21,Z+3
 250 003c FB01      		movw r30,r22
 251 003e 8080      		ld r8,Z
 252 0040 9180      		ldd r9,Z+1
 253 0042 840E      		add r8,r20
 254 0044 951E      		adc r9,r21
  22:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   
  23:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   if( MELF_ST_TYPE(sym->st_info) == STT_SOS_DFUNC ) {
 256               	.LM3:
 257 0046 F301      		movw r30,r6
 258 0048 8281      		ldd r24,Z+2
 259 004a 9927      		clr r25
 260 004c 8F70      		andi r24,lo8(15)
 261 004e 9070      		andi r25,hi8(15)
 262 0050 2081      		ld r18,Z
 263 0052 3181      		ldd r19,Z+1
 264 0054 0597      		sbiw r24,5
 265 0056 91F4      		brne .L2
 266               	.LBB2:
  24:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	sos_pid_t pid = (sos_pid_t)((sym->st_value >> 8) & 0x00ff);
 268               	.LM4:
 269 0058 232F      		mov r18,r19
 270 005a 3327      		clr r19
  25:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	uint8_t fid = (uint8_t)(sym->st_value & 0x00ff);
 272               	.LM5:
 273 005c 8081      		ld r24,Z
  26:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	reloc_addr = (uint16_t)ker_fntable_get_dfunc_addr(pid, fid);
 275               	.LM6:
 276 005e 682F      		mov r22,r24
 277 0060 822F      		mov r24,r18
 278 0062 0E94 0000 		call ker_fntable_get_dfunc_addr
 279 0066 6C01      		movw r12,r24
 280 0068 EE24      		clr r14
 281 006a FF24      		clr r15
  27:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	if( reloc_addr == 0 ) return -1;
 283               	.LM7:
 284 006c C114      		cp r12,__zero_reg__
 285 006e D104      		cpc r13,__zero_reg__
 286 0070 E104      		cpc r14,__zero_reg__
 287 0072 F104      		cpc r15,__zero_reg__
 288 0074 F9F4      		brne .L4
 289 0076 8FEF      		ldi r24,lo8(-1)
 290 0078 9FEF      		ldi r25,hi8(-1)
 291 007a 3DC1      		rjmp .L1
 292               	.L2:
 293               	.LBE2:
  28:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   } else {
  29:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	reloc_addr = mdesc->base_addr + (uint32_t) progshdr->sh_offset + (uint32_t)sym->st_value + (uint32
 295               	.LM8:
 296 007c CA01      		movw r24,r20
 297 007e AA27      		clr r26
 298 0080 BB27      		clr r27
 299 0082 F201      		movw r30,r4
 300 0084 C680      		ldd r12,Z+6
 301 0086 D780      		ldd r13,Z+7
 302 0088 E084      		ldd r14,Z+8
 303 008a F184      		ldd r15,Z+9
 304 008c C80E      		add r12,r24
 305 008e D91E      		adc r13,r25
 306 0090 EA1E      		adc r14,r26
 307 0092 FB1E      		adc r15,r27
 308 0094 C901      		movw r24,r18
 309 0096 AA27      		clr r26
 310 0098 BB27      		clr r27
 311 009a C80E      		add r12,r24
 312 009c D91E      		adc r13,r25
 313 009e EA1E      		adc r14,r26
 314 00a0 FB1E      		adc r15,r27
 315 00a2 FB01      		movw r30,r22
 316 00a4 8481      		ldd r24,Z+4
 317 00a6 9581      		ldd r25,Z+5
 318 00a8 AA27      		clr r26
 319 00aa BB27      		clr r27
 320 00ac C80E      		add r12,r24
 321 00ae D91E      		adc r13,r25
 322 00b0 EA1E      		adc r14,r26
 323 00b2 FB1E      		adc r15,r27
 324               	.L4:
  30:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   }
  31:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  32:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   ker_codemem_read(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 4, reloc_offset);
 326               	.LM9:
 327 00b4 8401      		movw r16,r8
 328 00b6 24E0      		ldi r18,lo8(4)
 329 00b8 30E0      		ldi r19,hi8(4)
 330 00ba AE01      		movw r20,r28
 331 00bc 4F5F      		subi r20,lo8(-(1))
 332 00be 5F4F      		sbci r21,hi8(-(1))
 333 00c0 61E1      		ldi r22,lo8(17)
 334 00c2 F201      		movw r30,r4
 335 00c4 8081      		ld r24,Z
 336 00c6 9181      		ldd r25,Z+1
 337 00c8 0E94 0000 		call ker_codemem_read
  33:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   
  34:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   switch (rela->r_type) {
 339               	.LM10:
 340 00cc F501      		movw r30,r10
 341 00ce 8681      		ldd r24,Z+6
 342 00d0 9927      		clr r25
 343 00d2 AA27      		clr r26
 344 00d4 BB27      		clr r27
 345 00d6 FC01      		movw r30,r24
 346 00d8 4397      		sbiw r24,19
 347 00da 08F0      		brlo .+2
 348 00dc 0AC1      		rjmp .L5
 349 00de E050      		subi r30,lo8(-(pm(.L38)))
 350 00e0 F040      		sbci r31,hi8(-(pm(.L38)))
 351 00e2 EE0F      		lsl r30
 352 00e4 FF1F      		rol r31
 353 00e6 0590      		lpm __tmp_reg__,Z+
 354 00e8 F491      		lpm r31,Z
 355 00ea E02D      		mov r30,__tmp_reg__
 356 00ec 0994      		ijmp
 357               		.data
 358               		.section .progmem.gcc_sw_table, "a", @progbits
 359               		.p2align 1
 360               	.L38:
 361 0000 0000      		.word pm(.L5)
 362 0002 0000      		.word pm(.L5)
 363 0004 0000      		.word pm(.L8)
 364 0006 0000      		.word pm(.L9)
 365 0008 0000      		.word pm(.L45)
 366 000a 0000      		.word pm(.L11)
 367 000c 0000      		.word pm(.L12)
 368 000e 0000      		.word pm(.L14)
 369 0010 0000      		.word pm(.L16)
 370 0012 0000      		.word pm(.L18)
 371 0014 0000      		.word pm(.L20)
 372 0016 0000      		.word pm(.L22)
 373 0018 0000      		.word pm(.L24)
 374 001a 0000      		.word pm(.L26)
 375 001c 0000      		.word pm(.L28)
 376 001e 0000      		.word pm(.L30)
 377 0020 0000      		.word pm(.L32)
 378 0022 0000      		.word pm(.L34)
 379 0024 0000      		.word pm(.L36)
 380               		.text
 381               	.L8:
 382               	.LBB3:
  35:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_NONE:
  36:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_32:
  37:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	  return 0;
  38:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_7_PCREL:
  39:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   {
  40:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       uint16_t pc = rela->r_offset >> 1; // Word address, relative to start of .text section
 384               	.LM11:
 385 00ee F501      		movw r30,r10
 386 00f0 6081      		ld r22,Z
 387 00f2 7181      		ldd r23,Z+1
 388 00f4 7695      		lsr r23
 389 00f6 6795      		ror r22
  41:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       uint16_t target_addr = ((uint32_t)sym->st_value + (uint32_t)rela->r_addend) >> 1; // Word add
 391               	.LM12:
 392 00f8 F301      		movw r30,r6
 393 00fa 8081      		ld r24,Z
 394 00fc 9181      		ldd r25,Z+1
 395 00fe AA27      		clr r26
 396 0100 BB27      		clr r27
 397 0102 F501      		movw r30,r10
 398 0104 2481      		ldd r18,Z+4
 399 0106 3581      		ldd r19,Z+5
 400 0108 4427      		clr r20
 401 010a 5527      		clr r21
 402 010c 820F      		add r24,r18
 403 010e 931F      		adc r25,r19
 404 0110 A41F      		adc r26,r20
 405 0112 B51F      		adc r27,r21
 406 0114 B695      		lsr r27
 407 0116 A795      		ror r26
 408 0118 9795      		ror r25
 409 011a 8795      		ror r24
  42:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       int16_t k = (int16_t)target_addr - (int16_t)pc - 1; // According to AVR ISA: target_addr = pc
 411               	.LM13:
 412 011c 861B      		sub r24,r22
 413 011e 970B      		sbc r25,r23
 414 0120 0197      		sbiw r24,1
  43:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       instr[0] |= (uint8_t) ((k << 3) & 0xf8);
 416               	.LM14:
 417 0122 382F      		mov r19,r24
 418 0124 330F      		lsl r19
 419 0126 330F      		lsl r19
 420 0128 330F      		lsl r19
 421 012a 2981      		ldd r18,Y+1
 422 012c 232B      		or r18,r19
 423 012e 2983      		std Y+1,r18
  44:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       instr[1] |= (uint8_t) ((k >> 5) & 0x03);
 425               	.LM15:
 426 0130 FE01      		movw r30,r28
 427 0132 3196      		adiw r30,1
 428 0134 A5E0      		ldi r26,5
 429 0136 9595      	1:	asr r25
 430 0138 8795      		ror r24
 431 013a AA95      		dec r26
 432 013c E1F7      		brne 1b
 433 013e 982F      		mov r25,r24
 434 0140 9370      		andi r25,lo8(3)
 435 0142 8181      		ldd r24,Z+1
 436 0144 892B      		or r24,r25
 437 0146 BDC0      		rjmp .L43
 438               	.L9:
 439               	.LBE3:
 440               	.LBB4:
  45:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  46:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 		
  47:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  48:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   }
  49:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     
  50:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_13_PCREL:
  51:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     {
  52:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       uint16_t pc = rela->r_offset >> 1; // Word address, relative to start of .text section
 442               	.LM16:
 443 0148 F501      		movw r30,r10
 444 014a 6081      		ld r22,Z
 445 014c 7181      		ldd r23,Z+1
 446 014e 7695      		lsr r23
 447 0150 6795      		ror r22
  53:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       uint16_t target_addr = ((uint32_t)sym->st_value + (uint32_t)rela->r_addend) >> 1; // Word add
 449               	.LM17:
 450 0152 F301      		movw r30,r6
 451 0154 8081      		ld r24,Z
 452 0156 9181      		ldd r25,Z+1
 453 0158 AA27      		clr r26
 454 015a BB27      		clr r27
 455 015c F501      		movw r30,r10
 456 015e 2481      		ldd r18,Z+4
 457 0160 3581      		ldd r19,Z+5
 458 0162 4427      		clr r20
 459 0164 5527      		clr r21
 460 0166 820F      		add r24,r18
 461 0168 931F      		adc r25,r19
 462 016a A41F      		adc r26,r20
 463 016c B51F      		adc r27,r21
 464 016e B695      		lsr r27
 465 0170 A795      		ror r26
 466 0172 9795      		ror r25
 467 0174 8795      		ror r24
  54:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       int16_t k = (int16_t)target_addr - (int16_t)pc - 1; // According to AVR ISA: target_addr = pc
 469               	.LM18:
 470 0176 861B      		sub r24,r22
 471 0178 970B      		sbc r25,r23
 472 017a 0197      		sbiw r24,1
  55:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       instr[0] = (uint8_t) k;
 474               	.LM19:
 475 017c 8983      		std Y+1,r24
  56:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       instr[1] = (instr[1] & 0xF0) | ((k >> 8) & 0x0F);
 477               	.LM20:
 478 017e FE01      		movw r30,r28
 479 0180 3196      		adiw r30,1
 480 0182 2181      		ldd r18,Z+1
 481 0184 207F      		andi r18,lo8(-16)
 482 0186 892F      		mov r24,r25
 483 0188 990F      		lsl r25
 484 018a 990B      		sbc r25,r25
 485 018c 8F70      		andi r24,lo8(15)
 486 018e 282B      		or r18,r24
 487 0190 2183      		std Z+1,r18
 488               	.L40:
  57:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 490               	.LM21:
 491 0192 8401      		movw r16,r8
 492 0194 22E0      		ldi r18,lo8(2)
 493 0196 30E0      		ldi r19,hi8(2)
 494 0198 AF01      		movw r20,r30
 495 019a A5C0      		rjmp .L39
 496               	.L11:
 497               	.LBE4:
  58:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****       break;
  59:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     }
  60:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  61:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_16:
  62:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[0] = (uint8_t)reloc_addr;
  63:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[1] = (uint8_t)(reloc_addr >> 8);
  64:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  65:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  66:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     
  67:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_16_PM:
  68:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     reloc_addr = (reloc_addr >> 1);
 499               	.LM22:
 500 019c F694      		lsr r15
 501 019e E794      		ror r14
 502 01a0 D794      		ror r13
 503 01a2 C794      		ror r12
 504               	.L45:
  69:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[0] = (uint8_t)reloc_addr;
 506               	.LM23:
 507 01a4 C982      		std Y+1,r12
  70:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[1] = (uint8_t)(reloc_addr >> 8);
 509               	.LM24:
 510 01a6 FE01      		movw r30,r28
 511 01a8 3196      		adiw r30,1
 512 01aa BB27      		clr r27
 513 01ac AF2D      		mov r26,r15
 514 01ae 9E2D      		mov r25,r14
 515 01b0 8D2D      		mov r24,r13
 516 01b2 87C0      		rjmp .L43
 517               	.L12:
 518               	.LBB5:
  71:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  72:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  73:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  74:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_LO8_LDI:
  75:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)reloc_addr);
  76:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  77:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  78:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  79:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HI8_LDI:
  80:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(reloc_addr >> 8));
  81:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  82:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  83:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  84:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HH8_LDI:
  85:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(reloc_addr >> 16));
  86:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  87:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  88:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     
  89:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_LO8_LDI_NEG:
  90:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(-reloc_addr));
  91:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  92:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  93:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
  94:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HI8_LDI_NEG:
  95:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)((-reloc_addr) >> 8));
  96:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
  97:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
  98:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     
  99:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HH8_LDI_NEG:
 100:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)((-reloc_addr) >> 16));
 101:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 102:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 103:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 104:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_LO8_LDI_PM:
 105:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(reloc_addr >> 1));
 106:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 107:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 108:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 109:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HI8_LDI_PM:
 110:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(reloc_addr >> 9));
 111:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 112:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 113:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 114:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HH8_LDI_PM:
 115:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)(reloc_addr >> 17));
 116:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 117:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 118:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 119:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_LO8_LDI_PM_NEG:
 120:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)((-reloc_addr) >> 1));
 121:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 122:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 123:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 124:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HI8_LDI_PM_NEG:
 125:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)((-reloc_addr) >> 9));
 126:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 127:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 128:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 129:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_HH8_LDI_PM_NEG:
 130:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     WRITE_LDI(instr, (uint8_t)((-reloc_addr) >> 17));
 131:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 2, reloc_offset);    
 132:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 133:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 134:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   case R_AVR_CALL:
 135:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 	//
 136:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     reloc_addr = (reloc_addr >> 1);
 137:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[2] = (uint8_t)(reloc_addr);
 138:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     instr[3] = (uint8_t)(reloc_addr >> 8);
 139:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     ker_codemem_write(mdesc->cmhdl, KER_DFT_LOADER_PID, (void*)instr, 4, reloc_offset);
 140:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 141:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 142:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   default:
 143:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****     break;
 144:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   }
 145:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** 
 146:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   return 0;
 147:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** }
 148:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** //----------------------------------------------------------
 149:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** static inline void WRITE_LDI(uint8_t* instr, uint8_t byte)
 150:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c **** {							
 520               	.LM25:
 521 01b4 FE01      		movw r30,r28
 522 01b6 3196      		adiw r30,1
 523 01b8 33C0      		rjmp .L44
 524               	.L14:
 525               	.LBE5:
 526               	.LBB6:
 527 01ba FE01      		movw r30,r28
 528 01bc 3196      		adiw r30,1
 529 01be BB27      		clr r27
 530 01c0 AF2D      		mov r26,r15
 531 01c2 9E2D      		mov r25,r14
 532 01c4 8D2D      		mov r24,r13
 533 01c6 71C0      		rjmp .L41
 534               	.L16:
 535               	.LBE6:
 536               	.LBB7:
 537 01c8 FE01      		movw r30,r28
 538 01ca 3196      		adiw r30,1
 539 01cc C701      		movw r24,r14
 540 01ce AA27      		clr r26
 541 01d0 BB27      		clr r27
 542 01d2 6BC0      		rjmp .L41
 543               	.L18:
 544               	.LBE7:
 545               	.LBB8:
 546 01d4 FE01      		movw r30,r28
 547 01d6 3196      		adiw r30,1
 548 01d8 2C2D      		mov r18,r12
 549 01da 2195      		neg r18
 550 01dc 67C0      		rjmp .L42
 551               	.L20:
 552               	.LBE8:
 553               	.LBB9:
 554 01de FE01      		movw r30,r28
 555 01e0 3196      		adiw r30,1
 556 01e2 8827      		clr r24
 557 01e4 9927      		clr r25
 558 01e6 DC01      		movw r26,r24
 559 01e8 8C19      		sub r24,r12
 560 01ea 9D09      		sbc r25,r13
 561 01ec AE09      		sbc r26,r14
 562 01ee BF09      		sbc r27,r15
 563 01f0 892F      		mov r24,r25
 564 01f2 9A2F      		mov r25,r26
 565 01f4 AB2F      		mov r26,r27
 566 01f6 BB27      		clr r27
 567 01f8 58C0      		rjmp .L41
 568               	.L22:
 569               	.LBE9:
 570               	.LBB10:
 571 01fa FE01      		movw r30,r28
 572 01fc 3196      		adiw r30,1
 573 01fe 8827      		clr r24
 574 0200 9927      		clr r25
 575 0202 DC01      		movw r26,r24
 576 0204 8C19      		sub r24,r12
 577 0206 9D09      		sbc r25,r13
 578 0208 AE09      		sbc r26,r14
 579 020a BF09      		sbc r27,r15
 580 020c CD01      		movw r24,r26
 581 020e AA27      		clr r26
 582 0210 BB27      		clr r27
 583 0212 4BC0      		rjmp .L41
 584               	.L24:
 585               	.LBE10:
 586               	.LBB11:
 587 0214 FE01      		movw r30,r28
 588 0216 3196      		adiw r30,1
 589 0218 F694      		lsr r15
 590 021a E794      		ror r14
 591 021c D794      		ror r13
 592 021e C794      		ror r12
 593               	.L44:
 594 0220 2C2D      		mov r18,r12
 595 0222 44C0      		rjmp .L42
 596               	.L26:
 597               	.LBE11:
 598               	.LBB12:
 599 0224 FE01      		movw r30,r28
 600 0226 3196      		adiw r30,1
 601 0228 69E0      		ldi r22,9
 602 022a F694      	1:	lsr r15
 603 022c E794      		ror r14
 604 022e D794      		ror r13
 605 0230 C794      		ror r12
 606 0232 6A95      		dec r22
 607 0234 D1F7      		brne 1b
 608 0236 F4CF      		rjmp .L44
 609               	.L28:
 610               	.LBE12:
 611               	.LBB13:
 612 0238 FE01      		movw r30,r28
 613 023a 3196      		adiw r30,1
 614 023c 51E1      		ldi r21,17
 615 023e F694      	1:	lsr r15
 616 0240 E794      		ror r14
 617 0242 D794      		ror r13
 618 0244 C794      		ror r12
 619 0246 5A95      		dec r21
 620 0248 D1F7      		brne 1b
 621 024a EACF      		rjmp .L44
 622               	.L30:
 623               	.LBE13:
 624               	.LBB14:
 625 024c FE01      		movw r30,r28
 626 024e 3196      		adiw r30,1
 627 0250 8827      		clr r24
 628 0252 9927      		clr r25
 629 0254 DC01      		movw r26,r24
 630 0256 8C19      		sub r24,r12
 631 0258 9D09      		sbc r25,r13
 632 025a AE09      		sbc r26,r14
 633 025c BF09      		sbc r27,r15
 634 025e B695      		lsr r27
 635 0260 A795      		ror r26
 636 0262 9795      		ror r25
 637 0264 8795      		ror r24
 638 0266 21C0      		rjmp .L41
 639               	.L32:
 640               	.LBE14:
 641               	.LBB15:
 642 0268 FE01      		movw r30,r28
 643 026a 3196      		adiw r30,1
 644 026c 8827      		clr r24
 645 026e 9927      		clr r25
 646 0270 DC01      		movw r26,r24
 647 0272 8C19      		sub r24,r12
 648 0274 9D09      		sbc r25,r13
 649 0276 AE09      		sbc r26,r14
 650 0278 BF09      		sbc r27,r15
 651 027a 39E0      		ldi r19,9
 652 027c B695      	1:	lsr r27
 653 027e A795      		ror r26
 654 0280 9795      		ror r25
 655 0282 8795      		ror r24
 656 0284 3A95      		dec r19
 657 0286 D1F7      		brne 1b
 658 0288 10C0      		rjmp .L41
 659               	.L34:
 660               	.LBE15:
 661               	.LBB16:
 662 028a FE01      		movw r30,r28
 663 028c 3196      		adiw r30,1
 664 028e 8827      		clr r24
 665 0290 9927      		clr r25
 666 0292 DC01      		movw r26,r24
 667 0294 8C19      		sub r24,r12
 668 0296 9D09      		sbc r25,r13
 669 0298 AE09      		sbc r26,r14
 670 029a BF09      		sbc r27,r15
 671 029c 21E1      		ldi r18,17
 672 029e B695      	1:	lsr r27
 673 02a0 A795      		ror r26
 674 02a2 9795      		ror r25
 675 02a4 8795      		ror r24
 676 02a6 2A95      		dec r18
 677 02a8 D1F7      		brne 1b
 678               	.L41:
 679 02aa 282F      		mov r18,r24
 680               	.L42:
 681               	.LBB17:
 151:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   instr[0] = (instr[0] & 0xf0) | (byte & 0x0f);	
 683               	.LM26:
 684 02ac 8981      		ldd r24,Y+1
 685 02ae 807F      		andi r24,lo8(-16)
 686 02b0 922F      		mov r25,r18
 687 02b2 9F70      		andi r25,lo8(15)
 688 02b4 892B      		or r24,r25
 689 02b6 8983      		std Y+1,r24
 152:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   //  instr[1] = (instr[0] & 0xf0) | (byte >> 4);
 153:/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c ****   instr[1] = (instr[1] & 0xf0) | (byte >> 4);
 691               	.LM27:
 692 02b8 8181      		ldd r24,Z+1
 693 02ba 807F      		andi r24,lo8(-16)
 694 02bc 2295      		swap r18
 695 02be 2F70      		andi r18,0x0f
 696 02c0 822B      		or r24,r18
 697               	.L43:
 698 02c2 8183      		std Z+1,r24
 699 02c4 66CF      		rjmp .L40
 700               	.L36:
 701               	.LBE17:
 702               	.LBE16:
 704               	.LM28:
 705 02c6 F694      		lsr r15
 706 02c8 E794      		ror r14
 707 02ca D794      		ror r13
 708 02cc C794      		ror r12
 710               	.LM29:
 711 02ce CB82      		std Y+3,r12
 713               	.LM30:
 714 02d0 BB27      		clr r27
 715 02d2 AF2D      		mov r26,r15
 716 02d4 9E2D      		mov r25,r14
 717 02d6 8D2D      		mov r24,r13
 718 02d8 8C83      		std Y+4,r24
 720               	.LM31:
 721 02da 8401      		movw r16,r8
 722 02dc 24E0      		ldi r18,lo8(4)
 723 02de 30E0      		ldi r19,hi8(4)
 724 02e0 AE01      		movw r20,r28
 725 02e2 4F5F      		subi r20,lo8(-(1))
 726 02e4 5F4F      		sbci r21,hi8(-(1))
 727               	.L39:
 728 02e6 61E1      		ldi r22,lo8(17)
 729 02e8 F201      		movw r30,r4
 730 02ea 8081      		ld r24,Z
 731 02ec 9181      		ldd r25,Z+1
 732 02ee 0E94 0000 		call ker_codemem_write
 733               	.L5:
 735               	.LM32:
 736 02f2 80E0      		ldi r24,lo8(0)
 737 02f4 90E0      		ldi r25,hi8(0)
 738               	.L1:
 739               	/* epilogue: frame size=4 */
 740 02f6 2496      		adiw r28,4
 741 02f8 0FB6      		in __tmp_reg__,__SREG__
 742 02fa F894      		cli
 743 02fc DEBF      		out __SP_H__,r29
 744 02fe 0FBE      		out __SREG__,__tmp_reg__
 745 0300 CDBF      		out __SP_L__,r28
 746 0302 DF91      		pop r29
 747 0304 CF91      		pop r28
 748 0306 1F91      		pop r17
 749 0308 0F91      		pop r16
 750 030a FF90      		pop r15
 751 030c EF90      		pop r14
 752 030e DF90      		pop r13
 753 0310 CF90      		pop r12
 754 0312 BF90      		pop r11
 755 0314 AF90      		pop r10
 756 0316 9F90      		pop r9
 757 0318 8F90      		pop r8
 758 031a 7F90      		pop r7
 759 031c 6F90      		pop r6
 760 031e 5F90      		pop r5
 761 0320 4F90      		pop r4
 762 0322 0895      		ret
 763               	/* epilogue end (size=23) */
 764               	/* function melf_arch_relocate size 423 (376) */
 828               	.Lscope0:
 830               		.text
 832               	Letext:
 833               	/* File "/Users/Administrator/sos-2x/tools/elfloader/soslib/avr_melfloader.c": code  423 = 0x01a7 (
DEFINED SYMBOLS
                            *ABS*:00000000 avr_melfloader.c
                            *ABS*:0000003f __SREG__
                            *ABS*:0000003e __SP_H__
                            *ABS*:0000003d __SP_L__
                            *ABS*:00000000 __tmp_reg__
                            *ABS*:00000001 __zero_reg__
/var/tmp//ccWp5Gth.s:213    .text:00000000 melf_arch_relocate
/var/tmp//ccWp5Gth.s:832    .text:00000324 Letext

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
ker_fntable_get_dfunc_addr
ker_codemem_read
ker_codemem_write
